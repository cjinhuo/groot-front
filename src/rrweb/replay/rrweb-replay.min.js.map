{"version":3,"file":"rrweb-replay.min.js","sources":["../../node_modules/tslib/tslib.es6.js","../../node_modules/rrweb-snapshot/es/rrweb-snapshot.js","../../node_modules/mitt/dist/mitt.es.js","../../src/types.ts","../../node_modules/smoothscroll-polyfill/dist/smoothscroll.js","../../src/replay/timer.ts","../../node_modules/@xstate/fsm/es/index.js","../../src/replay/machine.ts","../../src/utils.ts","../../src/replay/styles/inject-style.ts","../../src/replay/index.ts"],"sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __createBinding(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (p !== \"default\" && !exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","var NodeType;\n(function (NodeType) {\n    NodeType[NodeType[\"Document\"] = 0] = \"Document\";\n    NodeType[NodeType[\"DocumentType\"] = 1] = \"DocumentType\";\n    NodeType[NodeType[\"Element\"] = 2] = \"Element\";\n    NodeType[NodeType[\"Text\"] = 3] = \"Text\";\n    NodeType[NodeType[\"CDATA\"] = 4] = \"CDATA\";\n    NodeType[NodeType[\"Comment\"] = 5] = \"Comment\";\n})(NodeType || (NodeType = {}));\n\nvar _id = 1;\nvar symbolAndNumberRegex = RegExp('[^a-z1-6\\-]');\nfunction genId() {\n    return _id++;\n}\nfunction getValidTagName(tagName) {\n    var processedTagName = tagName.toLowerCase().trim();\n    if (symbolAndNumberRegex.test(processedTagName)) {\n        return 'div';\n    }\n    return processedTagName;\n}\nfunction getCssRulesString(s) {\n    try {\n        var rules = s.rules || s.cssRules;\n        return rules\n            ? Array.from(rules).reduce(function (prev, cur) { return prev + getCssRuleString(cur); }, '')\n            : null;\n    }\n    catch (error) {\n        return null;\n    }\n}\nfunction getCssRuleString(rule) {\n    return isCSSImportRule(rule)\n        ? getCssRulesString(rule.styleSheet) || ''\n        : rule.cssText;\n}\nfunction isCSSImportRule(rule) {\n    return 'styleSheet' in rule;\n}\nfunction extractOrigin(url) {\n    var origin;\n    if (url.indexOf('//') > -1) {\n        origin = url\n            .split('/')\n            .slice(0, 3)\n            .join('/');\n    }\n    else {\n        origin = url.split('/')[0];\n    }\n    origin = origin.split('?')[0];\n    return origin;\n}\nvar URL_IN_CSS_REF = /url\\((?:'([^']*)'|\"([^\"]*)\"|([^)]*))\\)/gm;\nvar RELATIVE_PATH = /^(?!www\\.|(?:http|ftp)s?:\\/\\/|[A-Za-z]:\\\\|\\/\\/).*/;\nvar DATA_URI = /^(data:)([\\w\\/\\+\\-]+);(charset=[\\w-]+|base64).*,(.*)/i;\nfunction absoluteToStylesheet(cssText, href) {\n    return (cssText || '').replace(URL_IN_CSS_REF, function (origin, path1, path2, path3) {\n        var filePath = path1 || path2 || path3;\n        if (!filePath) {\n            return origin;\n        }\n        if (!RELATIVE_PATH.test(filePath)) {\n            return \"url('\" + filePath + \"')\";\n        }\n        if (DATA_URI.test(filePath)) {\n            return \"url(\" + filePath + \")\";\n        }\n        if (filePath[0] === '/') {\n            return \"url('\" + (extractOrigin(href) + filePath) + \"')\";\n        }\n        var stack = href.split('/');\n        var parts = filePath.split('/');\n        stack.pop();\n        for (var _i = 0, parts_1 = parts; _i < parts_1.length; _i++) {\n            var part = parts_1[_i];\n            if (part === '.') {\n                continue;\n            }\n            else if (part === '..') {\n                stack.pop();\n            }\n            else {\n                stack.push(part);\n            }\n        }\n        return \"url('\" + stack.join('/') + \"')\";\n    });\n}\nfunction getAbsoluteSrcsetString(doc, attributeValue) {\n    if (attributeValue.trim() === '') {\n        return attributeValue;\n    }\n    var srcsetValues = attributeValue.split(',');\n    var resultingSrcsetString = srcsetValues\n        .map(function (srcItem) {\n        var trimmedSrcItem = srcItem.trimLeft().trimRight();\n        var urlAndSize = trimmedSrcItem.split(' ');\n        if (urlAndSize.length === 2) {\n            var absUrl = absoluteToDoc(doc, urlAndSize[0]);\n            return absUrl + \" \" + urlAndSize[1];\n        }\n        else if (urlAndSize.length === 1) {\n            var absUrl = absoluteToDoc(doc, urlAndSize[0]);\n            return \"\" + absUrl;\n        }\n        return '';\n    })\n        .join(',');\n    return resultingSrcsetString;\n}\nfunction absoluteToDoc(doc, attributeValue) {\n    if (!attributeValue || attributeValue.trim() === '') {\n        return attributeValue;\n    }\n    var a = doc.createElement('a');\n    a.href = attributeValue;\n    return a.href;\n}\nfunction isSVGElement(el) {\n    return el.tagName === 'svg' || el instanceof SVGElement;\n}\nfunction transformAttribute(doc, name, value) {\n    if (name === 'src' || (name === 'href' && value)) {\n        return absoluteToDoc(doc, value);\n    }\n    else if (name === 'srcset' && value) {\n        return getAbsoluteSrcsetString(doc, value);\n    }\n    else if (name === 'style' && value) {\n        return absoluteToStylesheet(value, location.href);\n    }\n    else {\n        return value;\n    }\n}\nfunction serializeNode(n, doc, blockClass, inlineStylesheet, maskAllInputs) {\n    switch (n.nodeType) {\n        case n.DOCUMENT_NODE:\n            return {\n                type: NodeType.Document,\n                childNodes: []\n            };\n        case n.DOCUMENT_TYPE_NODE:\n            return {\n                type: NodeType.DocumentType,\n                name: n.name,\n                publicId: n.publicId,\n                systemId: n.systemId\n            };\n        case n.ELEMENT_NODE:\n            var needBlock_1 = false;\n            if (typeof blockClass === 'string') {\n                needBlock_1 = n.classList.contains(blockClass);\n            }\n            else {\n                n.classList.forEach(function (className) {\n                    if (blockClass.test(className)) {\n                        needBlock_1 = true;\n                    }\n                });\n            }\n            var tagName = getValidTagName(n.tagName);\n            var attributes_1 = {};\n            for (var _i = 0, _a = Array.from(n.attributes); _i < _a.length; _i++) {\n                var _b = _a[_i], name = _b.name, value = _b.value;\n                attributes_1[name] = transformAttribute(doc, name, value);\n            }\n            if (tagName === 'link' && inlineStylesheet) {\n                var stylesheet = Array.from(doc.styleSheets).find(function (s) {\n                    return s.href === n.href;\n                });\n                var cssText = getCssRulesString(stylesheet);\n                if (cssText) {\n                    delete attributes_1.rel;\n                    delete attributes_1.href;\n                    attributes_1._cssText = absoluteToStylesheet(cssText, stylesheet.href);\n                }\n            }\n            if (tagName === 'style' &&\n                n.sheet &&\n                !(n.innerText ||\n                    n.textContent ||\n                    '').trim().length) {\n                var cssText = getCssRulesString(n.sheet);\n                if (cssText) {\n                    attributes_1._cssText = absoluteToStylesheet(cssText, location.href);\n                }\n            }\n            if (tagName === 'input' ||\n                tagName === 'textarea' ||\n                tagName === 'select') {\n                var value = n.value;\n                if (attributes_1.type !== 'radio' &&\n                    attributes_1.type !== 'checkbox' &&\n                    value) {\n                    attributes_1.value = maskAllInputs ? '*'.repeat(value.length) : value;\n                }\n                else if (n.checked) {\n                    attributes_1.checked = n.checked;\n                }\n            }\n            if (tagName === 'option') {\n                var selectValue = n.parentElement;\n                if (attributes_1.value === selectValue.value) {\n                    attributes_1.selected = n.selected;\n                }\n            }\n            if (tagName === 'canvas') {\n                attributes_1.rr_dataURL = n.toDataURL();\n            }\n            if (tagName === 'audio' || tagName === 'video') {\n                attributes_1.rr_mediaState = n.paused\n                    ? 'paused'\n                    : 'played';\n            }\n            if (needBlock_1) {\n                var _c = n.getBoundingClientRect(), width = _c.width, height = _c.height;\n                attributes_1.rr_width = width + \"px\";\n                attributes_1.rr_height = height + \"px\";\n            }\n            return {\n                type: NodeType.Element,\n                tagName: tagName,\n                attributes: attributes_1,\n                childNodes: [],\n                isSVG: isSVGElement(n) || undefined,\n                needBlock: needBlock_1\n            };\n        case n.TEXT_NODE:\n            var parentTagName = n.parentNode && n.parentNode.tagName;\n            var textContent = n.textContent;\n            var isStyle = parentTagName === 'STYLE' ? true : undefined;\n            if (isStyle && textContent) {\n                textContent = absoluteToStylesheet(textContent, location.href);\n            }\n            if (parentTagName === 'SCRIPT') {\n                textContent = 'SCRIPT_PLACEHOLDER';\n            }\n            return {\n                type: NodeType.Text,\n                textContent: textContent || '',\n                isStyle: isStyle\n            };\n        case n.CDATA_SECTION_NODE:\n            return {\n                type: NodeType.CDATA,\n                textContent: ''\n            };\n        case n.COMMENT_NODE:\n            return {\n                type: NodeType.Comment,\n                textContent: n.textContent || ''\n            };\n        default:\n            return false;\n    }\n}\nfunction serializeNodeWithId(n, doc, map, blockClass, skipChild, inlineStylesheet, maskAllInputs) {\n    if (skipChild === void 0) { skipChild = false; }\n    if (inlineStylesheet === void 0) { inlineStylesheet = true; }\n    if (maskAllInputs === void 0) { maskAllInputs = false; }\n    var _serializedNode = serializeNode(n, doc, blockClass, inlineStylesheet, maskAllInputs);\n    if (!_serializedNode) {\n        console.warn(n, 'not serialized');\n        return null;\n    }\n    var id;\n    if ('__sn' in n) {\n        id = n.__sn.id;\n    }\n    else {\n        id = genId();\n    }\n    var serializedNode = Object.assign(_serializedNode, { id: id });\n    n.__sn = serializedNode;\n    map[id] = n;\n    var recordChild = !skipChild;\n    if (serializedNode.type === NodeType.Element) {\n        recordChild = recordChild && !serializedNode.needBlock;\n        delete serializedNode.needBlock;\n    }\n    if ((serializedNode.type === NodeType.Document ||\n        serializedNode.type === NodeType.Element) &&\n        recordChild) {\n        for (var _i = 0, _a = Array.from(n.childNodes); _i < _a.length; _i++) {\n            var childN = _a[_i];\n            var serializedChildNode = serializeNodeWithId(childN, doc, map, blockClass, skipChild, inlineStylesheet, maskAllInputs);\n            if (serializedChildNode) {\n                serializedNode.childNodes.push(serializedChildNode);\n            }\n        }\n    }\n    return serializedNode;\n}\nfunction snapshot(n, blockClass, inlineStylesheet, maskAllInputs) {\n    if (blockClass === void 0) { blockClass = 'rr-block'; }\n    if (inlineStylesheet === void 0) { inlineStylesheet = true; }\n    if (maskAllInputs === void 0) { maskAllInputs = false; }\n    var idNodeMap = {};\n    return [\n        serializeNodeWithId(n, n, idNodeMap, blockClass, false, inlineStylesheet, maskAllInputs),\n        idNodeMap,\n    ];\n}\n\nvar commentre = /\\/\\*[^*]*\\*+([^/*][^*]*\\*+)*\\//g;\nfunction parse(css, options) {\n    if (options === void 0) { options = {}; }\n    var lineno = 1;\n    var column = 1;\n    function updatePosition(str) {\n        var lines = str.match(/\\n/g);\n        if (lines) {\n            lineno += lines.length;\n        }\n        var i = str.lastIndexOf('\\n');\n        column = i === -1 ? column + str.length : str.length - i;\n    }\n    function position() {\n        var start = { line: lineno, column: column };\n        return function (node) {\n            node.position = new Position(start);\n            whitespace();\n            return node;\n        };\n    }\n    var Position = (function () {\n        function Position(start) {\n            this.start = start;\n            this.end = { line: lineno, column: column };\n            this.source = options.source;\n        }\n        return Position;\n    }());\n    Position.prototype.content = css;\n    var errorsList = [];\n    function error(msg) {\n        var err = new Error(options.source + ':' + lineno + ':' + column + ': ' + msg);\n        err.reason = msg;\n        err.filename = options.source;\n        err.line = lineno;\n        err.column = column;\n        err.source = css;\n        if (options.silent) {\n            errorsList.push(err);\n        }\n        else {\n            throw err;\n        }\n    }\n    function stylesheet() {\n        var rulesList = rules();\n        return {\n            type: 'stylesheet',\n            stylesheet: {\n                source: options.source,\n                rules: rulesList,\n                parsingErrors: errorsList\n            }\n        };\n    }\n    function open() {\n        return match(/^{\\s*/);\n    }\n    function close() {\n        return match(/^}/);\n    }\n    function rules() {\n        var node;\n        var rules = [];\n        whitespace();\n        comments(rules);\n        while (css.length && css.charAt(0) !== '}' && (node = atrule() || rule())) {\n            if (node !== false) {\n                rules.push(node);\n                comments(rules);\n            }\n        }\n        return rules;\n    }\n    function match(re) {\n        var m = re.exec(css);\n        if (!m) {\n            return;\n        }\n        var str = m[0];\n        updatePosition(str);\n        css = css.slice(str.length);\n        return m;\n    }\n    function whitespace() {\n        match(/^\\s*/);\n    }\n    function comments(rules) {\n        if (rules === void 0) { rules = []; }\n        var c;\n        while ((c = comment())) {\n            if (c !== false) {\n                rules.push(c);\n            }\n            c = comment();\n        }\n        return rules;\n    }\n    function comment() {\n        var pos = position();\n        if ('/' !== css.charAt(0) || '*' !== css.charAt(1)) {\n            return;\n        }\n        var i = 2;\n        while ('' !== css.charAt(i) &&\n            ('*' !== css.charAt(i) || '/' !== css.charAt(i + 1))) {\n            ++i;\n        }\n        i += 2;\n        if ('' === css.charAt(i - 1)) {\n            return error('End of comment missing');\n        }\n        var str = css.slice(2, i - 2);\n        column += 2;\n        updatePosition(str);\n        css = css.slice(i);\n        column += 2;\n        return pos({\n            type: 'comment',\n            comment: str\n        });\n    }\n    function selector() {\n        var m = match(/^([^{]+)/);\n        if (!m) {\n            return;\n        }\n        return trim(m[0])\n            .replace(/\\/\\*([^*]|[\\r\\n]|(\\*+([^*/]|[\\r\\n])))*\\*\\/+/g, '')\n            .replace(/\"(?:\\\\\"|[^\"])*\"|'(?:\\\\'|[^'])*'/g, function (m) {\n            return m.replace(/,/g, '\\u200C');\n        })\n            .split(/\\s*(?![^(]*\\)),\\s*/)\n            .map(function (s) {\n            return s.replace(/\\u200C/g, ',');\n        });\n    }\n    function declaration() {\n        var pos = position();\n        var propMatch = match(/^(\\*?[-#\\/\\*\\\\\\w]+(\\[[0-9a-z_-]+\\])?)\\s*/);\n        if (!propMatch) {\n            return;\n        }\n        var prop = trim(propMatch[0]);\n        if (!match(/^:\\s*/)) {\n            return error(\"property missing ':'\");\n        }\n        var val = match(/^((?:'(?:\\\\'|.)*?'|\"(?:\\\\\"|.)*?\"|\\([^\\)]*?\\)|[^};])+)/);\n        var ret = pos({\n            type: 'declaration',\n            property: prop.replace(commentre, ''),\n            value: val ? trim(val[0]).replace(commentre, '') : ''\n        });\n        match(/^[;\\s]*/);\n        return ret;\n    }\n    function declarations() {\n        var decls = [];\n        if (!open()) {\n            return error(\"missing '{'\");\n        }\n        comments(decls);\n        var decl;\n        while ((decl = declaration())) {\n            if (decl !== false) {\n                decls.push(decl);\n                comments(decls);\n            }\n            decl = declaration();\n        }\n        if (!close()) {\n            return error(\"missing '}'\");\n        }\n        return decls;\n    }\n    function keyframe() {\n        var m;\n        var vals = [];\n        var pos = position();\n        while ((m = match(/^((\\d+\\.\\d+|\\.\\d+|\\d+)%?|[a-z]+)\\s*/))) {\n            vals.push(m[1]);\n            match(/^,\\s*/);\n        }\n        if (!vals.length) {\n            return;\n        }\n        return pos({\n            type: 'keyframe',\n            values: vals,\n            declarations: declarations()\n        });\n    }\n    function atkeyframes() {\n        var pos = position();\n        var m = match(/^@([-\\w]+)?keyframes\\s*/);\n        if (!m) {\n            return;\n        }\n        var vendor = m[1];\n        m = match(/^([-\\w]+)\\s*/);\n        if (!m) {\n            return error('@keyframes missing name');\n        }\n        var name = m[1];\n        if (!open()) {\n            return error(\"@keyframes missing '{'\");\n        }\n        var frame;\n        var frames = comments();\n        while ((frame = keyframe())) {\n            frames.push(frame);\n            frames = frames.concat(comments());\n        }\n        if (!close()) {\n            return error(\"@keyframes missing '}'\");\n        }\n        return pos({\n            type: 'keyframes',\n            name: name,\n            vendor: vendor,\n            keyframes: frames\n        });\n    }\n    function atsupports() {\n        var pos = position();\n        var m = match(/^@supports *([^{]+)/);\n        if (!m) {\n            return;\n        }\n        var supports = trim(m[1]);\n        if (!open()) {\n            return error(\"@supports missing '{'\");\n        }\n        var style = comments().concat(rules());\n        if (!close()) {\n            return error(\"@supports missing '}'\");\n        }\n        return pos({\n            type: 'supports',\n            supports: supports,\n            rules: style\n        });\n    }\n    function athost() {\n        var pos = position();\n        var m = match(/^@host\\s*/);\n        if (!m) {\n            return;\n        }\n        if (!open()) {\n            return error(\"@host missing '{'\");\n        }\n        var style = comments().concat(rules());\n        if (!close()) {\n            return error(\"@host missing '}'\");\n        }\n        return pos({\n            type: 'host',\n            rules: style\n        });\n    }\n    function atmedia() {\n        var pos = position();\n        var m = match(/^@media *([^{]+)/);\n        if (!m) {\n            return;\n        }\n        var media = trim(m[1]);\n        if (!open()) {\n            return error(\"@media missing '{'\");\n        }\n        var style = comments().concat(rules());\n        if (!close()) {\n            return error(\"@media missing '}'\");\n        }\n        return pos({\n            type: 'media',\n            media: media,\n            rules: style\n        });\n    }\n    function atcustommedia() {\n        var pos = position();\n        var m = match(/^@custom-media\\s+(--[^\\s]+)\\s*([^{;]+);/);\n        if (!m) {\n            return;\n        }\n        return pos({\n            type: 'custom-media',\n            name: trim(m[1]),\n            media: trim(m[2])\n        });\n    }\n    function atpage() {\n        var pos = position();\n        var m = match(/^@page */);\n        if (!m) {\n            return;\n        }\n        var sel = selector() || [];\n        if (!open()) {\n            return error(\"@page missing '{'\");\n        }\n        var decls = comments();\n        var decl;\n        while ((decl = declaration())) {\n            decls.push(decl);\n            decls = decls.concat(comments());\n        }\n        if (!close()) {\n            return error(\"@page missing '}'\");\n        }\n        return pos({\n            type: 'page',\n            selectors: sel,\n            declarations: decls\n        });\n    }\n    function atdocument() {\n        var pos = position();\n        var m = match(/^@([-\\w]+)?document *([^{]+)/);\n        if (!m) {\n            return;\n        }\n        var vendor = trim(m[1]);\n        var doc = trim(m[2]);\n        if (!open()) {\n            return error(\"@document missing '{'\");\n        }\n        var style = comments().concat(rules());\n        if (!close()) {\n            return error(\"@document missing '}'\");\n        }\n        return pos({\n            type: 'document',\n            document: doc,\n            vendor: vendor,\n            rules: style\n        });\n    }\n    function atfontface() {\n        var pos = position();\n        var m = match(/^@font-face\\s*/);\n        if (!m) {\n            return;\n        }\n        if (!open()) {\n            return error(\"@font-face missing '{'\");\n        }\n        var decls = comments();\n        var decl;\n        while ((decl = declaration())) {\n            decls.push(decl);\n            decls = decls.concat(comments());\n        }\n        if (!close()) {\n            return error(\"@font-face missing '}'\");\n        }\n        return pos({\n            type: 'font-face',\n            declarations: decls\n        });\n    }\n    var atimport = _compileAtrule('import');\n    var atcharset = _compileAtrule('charset');\n    var atnamespace = _compileAtrule('namespace');\n    function _compileAtrule(name) {\n        var re = new RegExp('^@' + name + '\\\\s*([^;]+);');\n        return function () {\n            var pos = position();\n            var m = match(re);\n            if (!m) {\n                return;\n            }\n            var ret = { type: name };\n            ret[name] = m[1].trim();\n            return pos(ret);\n        };\n    }\n    function atrule() {\n        if (css[0] !== '@') {\n            return;\n        }\n        return (atkeyframes() ||\n            atmedia() ||\n            atcustommedia() ||\n            atsupports() ||\n            atimport() ||\n            atcharset() ||\n            atnamespace() ||\n            atdocument() ||\n            atpage() ||\n            athost() ||\n            atfontface());\n    }\n    function rule() {\n        var pos = position();\n        var sel = selector();\n        if (!sel) {\n            return error('selector missing');\n        }\n        comments();\n        return pos({\n            type: 'rule',\n            selectors: sel,\n            declarations: declarations()\n        });\n    }\n    return addParent(stylesheet());\n}\nfunction trim(str) {\n    return str ? str.replace(/^\\s+|\\s+$/g, '') : '';\n}\nfunction addParent(obj, parent) {\n    var isNode = obj && typeof obj.type === 'string';\n    var childParent = isNode ? obj : parent;\n    for (var _i = 0, _a = Object.keys(obj); _i < _a.length; _i++) {\n        var k = _a[_i];\n        var value = obj[k];\n        if (Array.isArray(value)) {\n            value.forEach(function (v) {\n                addParent(v, childParent);\n            });\n        }\n        else if (value && typeof value === 'object') {\n            addParent(value, childParent);\n        }\n    }\n    if (isNode) {\n        Object.defineProperty(obj, 'parent', {\n            configurable: true,\n            writable: true,\n            enumerable: false,\n            value: parent || null\n        });\n    }\n    return obj;\n}\n\nvar tagMap = {\n    script: 'noscript',\n    altglyph: 'altGlyph',\n    altglyphdef: 'altGlyphDef',\n    altglyphitem: 'altGlyphItem',\n    animatecolor: 'animateColor',\n    animatemotion: 'animateMotion',\n    animatetransform: 'animateTransform',\n    clippath: 'clipPath',\n    feblend: 'feBlend',\n    fecolormatrix: 'feColorMatrix',\n    fecomponenttransfer: 'feComponentTransfer',\n    fecomposite: 'feComposite',\n    feconvolvematrix: 'feConvolveMatrix',\n    fediffuselighting: 'feDiffuseLighting',\n    fedisplacementmap: 'feDisplacementMap',\n    fedistantlight: 'feDistantLight',\n    fedropshadow: 'feDropShadow',\n    feflood: 'feFlood',\n    fefunca: 'feFuncA',\n    fefuncb: 'feFuncB',\n    fefuncg: 'feFuncG',\n    fefuncr: 'feFuncR',\n    fegaussianblur: 'feGaussianBlur',\n    feimage: 'feImage',\n    femerge: 'feMerge',\n    femergenode: 'feMergeNode',\n    femorphology: 'feMorphology',\n    feoffset: 'feOffset',\n    fepointlight: 'fePointLight',\n    fespecularlighting: 'feSpecularLighting',\n    fespotlight: 'feSpotLight',\n    fetile: 'feTile',\n    feturbulence: 'feTurbulence',\n    foreignobject: 'foreignObject',\n    glyphref: 'glyphRef',\n    lineargradient: 'linearGradient',\n    radialgradient: 'radialGradient'\n};\nfunction getTagName(n) {\n    var tagName = tagMap[n.tagName] ? tagMap[n.tagName] : n.tagName;\n    if (tagName === 'link' && n.attributes._cssText) {\n        tagName = 'style';\n    }\n    return tagName;\n}\nvar HOVER_SELECTOR = /([^\\\\]):hover/g;\nfunction addHoverClass(cssText) {\n    var ast = parse(cssText, { silent: true });\n    if (!ast.stylesheet) {\n        return cssText;\n    }\n    ast.stylesheet.rules.forEach(function (rule) {\n        if ('selectors' in rule) {\n            (rule.selectors || []).forEach(function (selector) {\n                if (HOVER_SELECTOR.test(selector)) {\n                    var newSelector = selector.replace(HOVER_SELECTOR, '$1.\\\\:hover');\n                    cssText = cssText.replace(selector, selector + \", \" + newSelector);\n                }\n            });\n        }\n    });\n    return cssText;\n}\nfunction buildNode(n, doc, HACK_CSS) {\n    switch (n.type) {\n        case NodeType.Document:\n            return doc.implementation.createDocument(null, '', null);\n        case NodeType.DocumentType:\n            return doc.implementation.createDocumentType(n.name, n.publicId, n.systemId);\n        case NodeType.Element:\n            var tagName = getTagName(n);\n            var node_1;\n            if (n.isSVG) {\n                node_1 = doc.createElementNS('http://www.w3.org/2000/svg', tagName);\n            }\n            else {\n                node_1 = doc.createElement(tagName);\n            }\n            var _loop_1 = function (name) {\n                if (!n.attributes.hasOwnProperty(name)) {\n                    return \"continue\";\n                }\n                var value = n.attributes[name];\n                value = typeof value === 'boolean' ? '' : value;\n                if (!name.startsWith('rr_')) {\n                    var isTextarea = tagName === 'textarea' && name === 'value';\n                    var isRemoteOrDynamicCss = tagName === 'style' && name === '_cssText';\n                    if (isRemoteOrDynamicCss && HACK_CSS) {\n                        value = addHoverClass(value);\n                    }\n                    if (isTextarea || isRemoteOrDynamicCss) {\n                        var child = doc.createTextNode(value);\n                        for (var _i = 0, _a = Array.from(node_1.childNodes); _i < _a.length; _i++) {\n                            var c = _a[_i];\n                            if (c.nodeType === node_1.TEXT_NODE) {\n                                node_1.removeChild(c);\n                            }\n                        }\n                        node_1.appendChild(child);\n                        return \"continue\";\n                    }\n                    if (tagName === 'iframe' && name === 'src') {\n                        return \"continue\";\n                    }\n                    try {\n                        if (n.isSVG && name === 'xlink:href') {\n                            node_1.setAttributeNS('http://www.w3.org/1999/xlink', name, value);\n                        }\n                        else if (name == 'onload' || name == 'onclick' || name.substring(0, 7) == 'onmouse') {\n                            node_1.setAttribute('_' + name, value);\n                        }\n                        else {\n                            node_1.setAttribute(name, value);\n                        }\n                    }\n                    catch (error) {\n                    }\n                }\n                else {\n                    if (tagName === 'canvas' && name === 'rr_dataURL') {\n                        var image_1 = document.createElement('img');\n                        image_1.src = value;\n                        image_1.onload = function () {\n                            var ctx = node_1.getContext('2d');\n                            if (ctx) {\n                                ctx.drawImage(image_1, 0, 0, image_1.width, image_1.height);\n                            }\n                        };\n                    }\n                    if (name === 'rr_width') {\n                        node_1.style.width = value;\n                    }\n                    if (name === 'rr_height') {\n                        node_1.style.height = value;\n                    }\n                    if (name === 'rr_mediaState') {\n                        switch (value) {\n                            case 'played':\n                                node_1.play();\n                            case 'paused':\n                                node_1.pause();\n                                break;\n                            default:\n                        }\n                    }\n                }\n            };\n            for (var name in n.attributes) {\n                _loop_1(name);\n            }\n            return node_1;\n        case NodeType.Text:\n            return doc.createTextNode(n.isStyle && HACK_CSS ? addHoverClass(n.textContent) : n.textContent);\n        case NodeType.CDATA:\n            return doc.createCDATASection(n.textContent);\n        case NodeType.Comment:\n            return doc.createComment(n.textContent);\n        default:\n            return null;\n    }\n}\nfunction buildNodeWithSN(n, doc, map, skipChild, HACK_CSS) {\n    if (skipChild === void 0) { skipChild = false; }\n    if (HACK_CSS === void 0) { HACK_CSS = true; }\n    var node = buildNode(n, doc, HACK_CSS);\n    if (!node) {\n        return null;\n    }\n    if (n.type === NodeType.Document) {\n        doc.close();\n        doc.open();\n        node = doc;\n    }\n    node.__sn = n;\n    map[n.id] = node;\n    if ((n.type === NodeType.Document || n.type === NodeType.Element) &&\n        !skipChild) {\n        for (var _i = 0, _a = n.childNodes; _i < _a.length; _i++) {\n            var childN = _a[_i];\n            var childNode = buildNodeWithSN(childN, doc, map, false, HACK_CSS);\n            if (!childNode) {\n                console.warn('Failed to rebuild', childN);\n            }\n            else {\n                node.appendChild(childNode);\n            }\n        }\n    }\n    return node;\n}\nfunction rebuild(n, doc, HACK_CSS) {\n    if (HACK_CSS === void 0) { HACK_CSS = true; }\n    var idNodeMap = {};\n    return [buildNodeWithSN(n, doc, idNodeMap, false, HACK_CSS), idNodeMap];\n}\n\nexport { snapshot, serializeNodeWithId, rebuild, buildNodeWithSN, addHoverClass, transformAttribute, NodeType };\n","//      \n// An event handler can take an optional event argument\n// and should not return a value\n                                          \n                                                               \n\n// An array of all currently registered event handlers for a type\n                                            \n                                                            \n// A map of event types and their corresponding event handlers.\n                        \n                                 \n                                   \n  \n\n/** Mitt: Tiny (~200b) functional event emitter / pubsub.\n *  @name mitt\n *  @returns {Mitt}\n */\nfunction mitt(all                 ) {\n\tall = all || Object.create(null);\n\n\treturn {\n\t\t/**\n\t\t * Register an event handler for the given type.\n\t\t *\n\t\t * @param  {String} type\tType of event to listen for, or `\"*\"` for all events\n\t\t * @param  {Function} handler Function to call in response to given event\n\t\t * @memberOf mitt\n\t\t */\n\t\ton: function on(type        , handler              ) {\n\t\t\t(all[type] || (all[type] = [])).push(handler);\n\t\t},\n\n\t\t/**\n\t\t * Remove an event handler for the given type.\n\t\t *\n\t\t * @param  {String} type\tType of event to unregister `handler` from, or `\"*\"`\n\t\t * @param  {Function} handler Handler function to remove\n\t\t * @memberOf mitt\n\t\t */\n\t\toff: function off(type        , handler              ) {\n\t\t\tif (all[type]) {\n\t\t\t\tall[type].splice(all[type].indexOf(handler) >>> 0, 1);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Invoke all handlers for the given type.\n\t\t * If present, `\"*\"` handlers are invoked after type-matched handlers.\n\t\t *\n\t\t * @param {String} type  The event type to invoke\n\t\t * @param {Any} [evt]  Any value (object is recommended and powerful), passed to each handler\n\t\t * @memberOf mitt\n\t\t */\n\t\temit: function emit(type        , evt     ) {\n\t\t\t(all[type] || []).slice().map(function (handler) { handler(evt); });\n\t\t\t(all['*'] || []).slice().map(function (handler) { handler(type, evt); });\n\t\t}\n\t};\n}\n\nexport default mitt;\n//# sourceMappingURL=mitt.es.js.map\n","import { serializedNodeWithId, idNodeMap, INode } from 'rrweb-snapshot';\nimport { PackFn, UnpackFn } from './packer/base';\n\nexport enum EventType {\n  DomContentLoaded,\n  Load,\n  FullSnapshot,\n  IncrementalSnapshot,\n  Meta,\n  Custom,\n}\n\nexport type domContentLoadedEvent = {\n  type: EventType.DomContentLoaded;\n  data: {};\n};\n\nexport type loadedEvent = {\n  type: EventType.Load;\n  data: {};\n};\n\nexport type fullSnapshotEvent = {\n  type: EventType.FullSnapshot;\n  data: {\n    node: serializedNodeWithId;\n    initialOffset: {\n      top: number;\n      left: number;\n    };\n  };\n};\n\nexport type incrementalSnapshotEvent = {\n  type: EventType.IncrementalSnapshot;\n  data: incrementalData;\n};\n\nexport type metaEvent = {\n  type: EventType.Meta;\n  data: {\n    href: string;\n    width: number;\n    height: number;\n  };\n};\n\nexport type customEvent<T = unknown> = {\n  type: EventType.Custom;\n  data: {\n    tag: string;\n    payload: T;\n  };\n};\n\nexport type styleSheetEvent = {};\n\nexport enum IncrementalSource {\n  Mutation,\n  MouseMove,\n  MouseInteraction,\n  Scroll,\n  ViewportResize,\n  Input,\n  TouchMove,\n  MediaInteraction,\n  StyleSheetRule,\n}\n\nexport type mutationData = {\n  source: IncrementalSource.Mutation;\n} & mutationCallbackParam;\n\nexport type mousemoveData = {\n  source: IncrementalSource.MouseMove | IncrementalSource.TouchMove;\n  positions: mousePosition[];\n};\n\nexport type mouseInteractionData = {\n  source: IncrementalSource.MouseInteraction;\n} & mouseInteractionParam;\n\nexport type scrollData = {\n  source: IncrementalSource.Scroll;\n} & scrollPosition;\n\nexport type viewportResizeData = {\n  source: IncrementalSource.ViewportResize;\n} & viewportResizeDimention;\n\nexport type inputData = {\n  source: IncrementalSource.Input;\n  id: number;\n} & inputValue;\n\nexport type mediaInteractionData = {\n  source: IncrementalSource.MediaInteraction;\n} & mediaInteractionParam;\n\nexport type styleSheetRuleData = {\n  source: IncrementalSource.StyleSheetRule;\n} & styleSheetRuleParam;\n\nexport type incrementalData =\n  | mutationData\n  | mousemoveData\n  | mouseInteractionData\n  | scrollData\n  | viewportResizeData\n  | inputData\n  | mediaInteractionData\n  | styleSheetRuleData;\n\nexport type event =\n  | domContentLoadedEvent\n  | loadedEvent\n  | fullSnapshotEvent\n  | incrementalSnapshotEvent\n  | metaEvent\n  | customEvent;\n\nexport type eventWithTime = event & {\n  timestamp: number;\n  delay?: number;\n};\n\nexport type blockClass = string | RegExp;\n\nexport type recordOptions<T> = {\n  emit?: (e: T, isCheckout?: boolean) => void;\n  checkoutEveryNth?: number;\n  checkoutEveryNms?: number;\n  blockClass?: blockClass;\n  ignoreClass?: string;\n  maskAllInputs?: boolean;\n  inlineStylesheet?: boolean;\n  hooks?: hooksParam;\n  mousemoveWait?: number;\n  packFn?: PackFn;\n};\n\nexport type observerParam = {\n  mutationCb: mutationCallBack;\n  mousemoveCb: mousemoveCallBack;\n  mouseInteractionCb: mouseInteractionCallBack;\n  scrollCb: scrollCallback;\n  viewportResizeCb: viewportResizeCallback;\n  inputCb: inputCallback;\n  mediaInteractionCb: mediaInteractionCallback;\n  blockClass: blockClass;\n  ignoreClass: string;\n  maskAllInputs: boolean;\n  inlineStylesheet: boolean;\n  styleSheetRuleCb: styleSheetRuleCallback;\n  mousemoveWait: number;\n};\n\nexport type hooksParam = {\n  mutation?: mutationCallBack;\n  mousemove?: mousemoveCallBack;\n  mouseInteraction?: mouseInteractionCallBack;\n  scroll?: scrollCallback;\n  viewportResize?: viewportResizeCallback;\n  input?: inputCallback;\n  mediaInteaction?: mediaInteractionCallback;\n  styleSheetRule?: styleSheetRuleCallback;\n};\n\n// https://dom.spec.whatwg.org/#interface-mutationrecord\nexport type mutationRecord = {\n  type: string,\n  target: Node,\n  oldValue: string | null,\n  addedNodes: NodeList,\n  removedNodes: NodeList,\n  attributeName: string | null,\n}\n\nexport type textCursor = {\n  node: Node;\n  value: string | null;\n};\nexport type textMutation = {\n  id: number;\n  value: string | null;\n};\n\nexport type attributeCursor = {\n  node: Node;\n  attributes: {\n    [key: string]: string | null;\n  };\n};\nexport type attributeMutation = {\n  id: number;\n  attributes: {\n    [key: string]: string | null;\n  };\n};\n\nexport type removedNodeMutation = {\n  parentId: number;\n  id: number;\n};\n\nexport type addedNodeMutation = {\n  parentId: number;\n  // Newly recorded mutations will not have previousId any more, just for compatibility\n  previousId?: number | null;\n  nextId: number | null;\n  node: serializedNodeWithId;\n};\n\ntype mutationCallbackParam = {\n  texts: textMutation[];\n  attributes: attributeMutation[];\n  removes: removedNodeMutation[];\n  adds: addedNodeMutation[];\n};\n\nexport type mutationCallBack = (m: mutationCallbackParam) => void;\n\nexport type mousemoveCallBack = (\n  p: mousePosition[],\n  source: IncrementalSource.MouseMove | IncrementalSource.TouchMove,\n) => void;\n\nexport type mousePosition = {\n  x: number;\n  y: number;\n  id: number;\n  timeOffset: number;\n};\n\nexport enum MouseInteractions {\n  MouseUp,\n  MouseDown,\n  Click,\n  ContextMenu,\n  DblClick,\n  Focus,\n  Blur,\n  TouchStart,\n  TouchMove_Departed, // we will start a separate observer for touch move event\n  TouchEnd,\n}\n\ntype mouseInteractionParam = {\n  type: MouseInteractions;\n  id: number;\n  x: number;\n  y: number;\n};\n\nexport type mouseInteractionCallBack = (d: mouseInteractionParam) => void;\n\nexport type scrollPosition = {\n  id: number;\n  x: number;\n  y: number;\n};\n\nexport type scrollCallback = (p: scrollPosition) => void;\n\nexport type styleSheetAddRule = {\n  rule: string;\n  index?: number;\n};\n\nexport type styleSheetDeleteRule = {\n  index: number;\n};\n\nexport type styleSheetRuleParam = {\n  id: number;\n  removes?: styleSheetDeleteRule[];\n  adds?: styleSheetAddRule[];\n};\n\nexport type styleSheetRuleCallback = (s: styleSheetRuleParam) => void;\n\nexport type viewportResizeDimention = {\n  width: number;\n  height: number;\n};\n\nexport type viewportResizeCallback = (d: viewportResizeDimention) => void;\n\nexport type inputValue = {\n  text: string;\n  isChecked: boolean;\n};\n\nexport type inputCallback = (v: inputValue & { id: number }) => void;\n\nexport const enum MediaInteractions {\n  Play,\n  Pause,\n}\n\nexport type mediaInteractionParam = {\n  type: MediaInteractions;\n  id: number;\n};\n\nexport type mediaInteractionCallback = (p: mediaInteractionParam) => void;\n\nexport type Mirror = {\n  map: idNodeMap;\n  getId: (n: INode) => number;\n  getNode: (id: number) => INode | null;\n  removeNodeFromMap: (n: INode) => void;\n  has: (id: number) => boolean;\n};\n\nexport type throttleOptions = {\n  leading?: boolean;\n  trailing?: boolean;\n};\n\nexport type listenerHandler = () => void;\nexport type hookResetter = () => void;\n\nexport type playerConfig = {\n  speed: number;\n  root: Element;\n  loadTimeout: number;\n  skipInactive: boolean;\n  showWarning: boolean;\n  showDebug: boolean;\n  blockClass: string;\n  liveMode: boolean;\n  insertStyleRules: string[];\n  triggerFocus: boolean;\n  unpackFn?: UnpackFn;\n};\n\nexport type playerMetaData = {\n  totalTime: number;\n};\n\nexport type missingNode = {\n  node: Node;\n  mutation: addedNodeMutation;\n};\nexport type missingNodeMap = {\n  [id: number]: missingNode;\n};\n\nexport type actionWithDelay = {\n  doAction: () => void;\n  delay: number;\n};\n\nexport type Handler = (event?: unknown) => void;\n\nexport type Emitter = {\n  on(type: string, handler: Handler): void;\n  emit(type: string, event?: unknown): void;\n};\n\nexport type Arguments<T> = T extends (...payload: infer U) => unknown\n  ? U\n  : unknown;\n\nexport enum ReplayerEvents {\n  Start = 'start',\n  Pause = 'pause',\n  Resume = 'resume',\n  Resize = 'resize',\n  Finish = 'finish',\n  FullsnapshotRebuilded = 'fullsnapshot-rebuilded',\n  LoadStylesheetStart = 'load-stylesheet-start',\n  LoadStylesheetEnd = 'load-stylesheet-end',\n  SkipStart = 'skip-start',\n  SkipEnd = 'skip-end',\n  MouseInteraction = 'mouse-interaction',\n  EventCast = 'event-cast',\n  CustomEvent = 'custom-event',\n}\n","/* smoothscroll v0.4.4 - 2019 - Dustan Kasten, Jeremias Menichelli - MIT License */\n(function () {\n  'use strict';\n\n  // polyfill\n  function polyfill() {\n    // aliases\n    var w = window;\n    var d = document;\n\n    // return if scroll behavior is supported and polyfill is not forced\n    if (\n      'scrollBehavior' in d.documentElement.style &&\n      w.__forceSmoothScrollPolyfill__ !== true\n    ) {\n      return;\n    }\n\n    // globals\n    var Element = w.HTMLElement || w.Element;\n    var SCROLL_TIME = 468;\n\n    // object gathering original scroll methods\n    var original = {\n      scroll: w.scroll || w.scrollTo,\n      scrollBy: w.scrollBy,\n      elementScroll: Element.prototype.scroll || scrollElement,\n      scrollIntoView: Element.prototype.scrollIntoView\n    };\n\n    // define timing method\n    var now =\n      w.performance && w.performance.now\n        ? w.performance.now.bind(w.performance)\n        : Date.now;\n\n    /**\n     * indicates if a the current browser is made by Microsoft\n     * @method isMicrosoftBrowser\n     * @param {String} userAgent\n     * @returns {Boolean}\n     */\n    function isMicrosoftBrowser(userAgent) {\n      var userAgentPatterns = ['MSIE ', 'Trident/', 'Edge/'];\n\n      return new RegExp(userAgentPatterns.join('|')).test(userAgent);\n    }\n\n    /*\n     * IE has rounding bug rounding down clientHeight and clientWidth and\n     * rounding up scrollHeight and scrollWidth causing false positives\n     * on hasScrollableSpace\n     */\n    var ROUNDING_TOLERANCE = isMicrosoftBrowser(w.navigator.userAgent) ? 1 : 0;\n\n    /**\n     * changes scroll position inside an element\n     * @method scrollElement\n     * @param {Number} x\n     * @param {Number} y\n     * @returns {undefined}\n     */\n    function scrollElement(x, y) {\n      this.scrollLeft = x;\n      this.scrollTop = y;\n    }\n\n    /**\n     * returns result of applying ease math function to a number\n     * @method ease\n     * @param {Number} k\n     * @returns {Number}\n     */\n    function ease(k) {\n      return 0.5 * (1 - Math.cos(Math.PI * k));\n    }\n\n    /**\n     * indicates if a smooth behavior should be applied\n     * @method shouldBailOut\n     * @param {Number|Object} firstArg\n     * @returns {Boolean}\n     */\n    function shouldBailOut(firstArg) {\n      if (\n        firstArg === null ||\n        typeof firstArg !== 'object' ||\n        firstArg.behavior === undefined ||\n        firstArg.behavior === 'auto' ||\n        firstArg.behavior === 'instant'\n      ) {\n        // first argument is not an object/null\n        // or behavior is auto, instant or undefined\n        return true;\n      }\n\n      if (typeof firstArg === 'object' && firstArg.behavior === 'smooth') {\n        // first argument is an object and behavior is smooth\n        return false;\n      }\n\n      // throw error when behavior is not supported\n      throw new TypeError(\n        'behavior member of ScrollOptions ' +\n          firstArg.behavior +\n          ' is not a valid value for enumeration ScrollBehavior.'\n      );\n    }\n\n    /**\n     * indicates if an element has scrollable space in the provided axis\n     * @method hasScrollableSpace\n     * @param {Node} el\n     * @param {String} axis\n     * @returns {Boolean}\n     */\n    function hasScrollableSpace(el, axis) {\n      if (axis === 'Y') {\n        return el.clientHeight + ROUNDING_TOLERANCE < el.scrollHeight;\n      }\n\n      if (axis === 'X') {\n        return el.clientWidth + ROUNDING_TOLERANCE < el.scrollWidth;\n      }\n    }\n\n    /**\n     * indicates if an element has a scrollable overflow property in the axis\n     * @method canOverflow\n     * @param {Node} el\n     * @param {String} axis\n     * @returns {Boolean}\n     */\n    function canOverflow(el, axis) {\n      var overflowValue = w.getComputedStyle(el, null)['overflow' + axis];\n\n      return overflowValue === 'auto' || overflowValue === 'scroll';\n    }\n\n    /**\n     * indicates if an element can be scrolled in either axis\n     * @method isScrollable\n     * @param {Node} el\n     * @param {String} axis\n     * @returns {Boolean}\n     */\n    function isScrollable(el) {\n      var isScrollableY = hasScrollableSpace(el, 'Y') && canOverflow(el, 'Y');\n      var isScrollableX = hasScrollableSpace(el, 'X') && canOverflow(el, 'X');\n\n      return isScrollableY || isScrollableX;\n    }\n\n    /**\n     * finds scrollable parent of an element\n     * @method findScrollableParent\n     * @param {Node} el\n     * @returns {Node} el\n     */\n    function findScrollableParent(el) {\n      while (el !== d.body && isScrollable(el) === false) {\n        el = el.parentNode || el.host;\n      }\n\n      return el;\n    }\n\n    /**\n     * self invoked function that, given a context, steps through scrolling\n     * @method step\n     * @param {Object} context\n     * @returns {undefined}\n     */\n    function step(context) {\n      var time = now();\n      var value;\n      var currentX;\n      var currentY;\n      var elapsed = (time - context.startTime) / SCROLL_TIME;\n\n      // avoid elapsed times higher than one\n      elapsed = elapsed > 1 ? 1 : elapsed;\n\n      // apply easing to elapsed time\n      value = ease(elapsed);\n\n      currentX = context.startX + (context.x - context.startX) * value;\n      currentY = context.startY + (context.y - context.startY) * value;\n\n      context.method.call(context.scrollable, currentX, currentY);\n\n      // scroll more if we have not reached our destination\n      if (currentX !== context.x || currentY !== context.y) {\n        w.requestAnimationFrame(step.bind(w, context));\n      }\n    }\n\n    /**\n     * scrolls window or element with a smooth behavior\n     * @method smoothScroll\n     * @param {Object|Node} el\n     * @param {Number} x\n     * @param {Number} y\n     * @returns {undefined}\n     */\n    function smoothScroll(el, x, y) {\n      var scrollable;\n      var startX;\n      var startY;\n      var method;\n      var startTime = now();\n\n      // define scroll context\n      if (el === d.body) {\n        scrollable = w;\n        startX = w.scrollX || w.pageXOffset;\n        startY = w.scrollY || w.pageYOffset;\n        method = original.scroll;\n      } else {\n        scrollable = el;\n        startX = el.scrollLeft;\n        startY = el.scrollTop;\n        method = scrollElement;\n      }\n\n      // scroll looping over a frame\n      step({\n        scrollable: scrollable,\n        method: method,\n        startTime: startTime,\n        startX: startX,\n        startY: startY,\n        x: x,\n        y: y\n      });\n    }\n\n    // ORIGINAL METHODS OVERRIDES\n    // w.scroll and w.scrollTo\n    w.scroll = w.scrollTo = function() {\n      // avoid action when no arguments are passed\n      if (arguments[0] === undefined) {\n        return;\n      }\n\n      // avoid smooth behavior if not required\n      if (shouldBailOut(arguments[0]) === true) {\n        original.scroll.call(\n          w,\n          arguments[0].left !== undefined\n            ? arguments[0].left\n            : typeof arguments[0] !== 'object'\n              ? arguments[0]\n              : w.scrollX || w.pageXOffset,\n          // use top prop, second argument if present or fallback to scrollY\n          arguments[0].top !== undefined\n            ? arguments[0].top\n            : arguments[1] !== undefined\n              ? arguments[1]\n              : w.scrollY || w.pageYOffset\n        );\n\n        return;\n      }\n\n      // LET THE SMOOTHNESS BEGIN!\n      smoothScroll.call(\n        w,\n        d.body,\n        arguments[0].left !== undefined\n          ? ~~arguments[0].left\n          : w.scrollX || w.pageXOffset,\n        arguments[0].top !== undefined\n          ? ~~arguments[0].top\n          : w.scrollY || w.pageYOffset\n      );\n    };\n\n    // w.scrollBy\n    w.scrollBy = function() {\n      // avoid action when no arguments are passed\n      if (arguments[0] === undefined) {\n        return;\n      }\n\n      // avoid smooth behavior if not required\n      if (shouldBailOut(arguments[0])) {\n        original.scrollBy.call(\n          w,\n          arguments[0].left !== undefined\n            ? arguments[0].left\n            : typeof arguments[0] !== 'object' ? arguments[0] : 0,\n          arguments[0].top !== undefined\n            ? arguments[0].top\n            : arguments[1] !== undefined ? arguments[1] : 0\n        );\n\n        return;\n      }\n\n      // LET THE SMOOTHNESS BEGIN!\n      smoothScroll.call(\n        w,\n        d.body,\n        ~~arguments[0].left + (w.scrollX || w.pageXOffset),\n        ~~arguments[0].top + (w.scrollY || w.pageYOffset)\n      );\n    };\n\n    // Element.prototype.scroll and Element.prototype.scrollTo\n    Element.prototype.scroll = Element.prototype.scrollTo = function() {\n      // avoid action when no arguments are passed\n      if (arguments[0] === undefined) {\n        return;\n      }\n\n      // avoid smooth behavior if not required\n      if (shouldBailOut(arguments[0]) === true) {\n        // if one number is passed, throw error to match Firefox implementation\n        if (typeof arguments[0] === 'number' && arguments[1] === undefined) {\n          throw new SyntaxError('Value could not be converted');\n        }\n\n        original.elementScroll.call(\n          this,\n          // use left prop, first number argument or fallback to scrollLeft\n          arguments[0].left !== undefined\n            ? ~~arguments[0].left\n            : typeof arguments[0] !== 'object' ? ~~arguments[0] : this.scrollLeft,\n          // use top prop, second argument or fallback to scrollTop\n          arguments[0].top !== undefined\n            ? ~~arguments[0].top\n            : arguments[1] !== undefined ? ~~arguments[1] : this.scrollTop\n        );\n\n        return;\n      }\n\n      var left = arguments[0].left;\n      var top = arguments[0].top;\n\n      // LET THE SMOOTHNESS BEGIN!\n      smoothScroll.call(\n        this,\n        this,\n        typeof left === 'undefined' ? this.scrollLeft : ~~left,\n        typeof top === 'undefined' ? this.scrollTop : ~~top\n      );\n    };\n\n    // Element.prototype.scrollBy\n    Element.prototype.scrollBy = function() {\n      // avoid action when no arguments are passed\n      if (arguments[0] === undefined) {\n        return;\n      }\n\n      // avoid smooth behavior if not required\n      if (shouldBailOut(arguments[0]) === true) {\n        original.elementScroll.call(\n          this,\n          arguments[0].left !== undefined\n            ? ~~arguments[0].left + this.scrollLeft\n            : ~~arguments[0] + this.scrollLeft,\n          arguments[0].top !== undefined\n            ? ~~arguments[0].top + this.scrollTop\n            : ~~arguments[1] + this.scrollTop\n        );\n\n        return;\n      }\n\n      this.scroll({\n        left: ~~arguments[0].left + this.scrollLeft,\n        top: ~~arguments[0].top + this.scrollTop,\n        behavior: arguments[0].behavior\n      });\n    };\n\n    // Element.prototype.scrollIntoView\n    Element.prototype.scrollIntoView = function() {\n      // avoid smooth behavior if not required\n      if (shouldBailOut(arguments[0]) === true) {\n        original.scrollIntoView.call(\n          this,\n          arguments[0] === undefined ? true : arguments[0]\n        );\n\n        return;\n      }\n\n      // LET THE SMOOTHNESS BEGIN!\n      var scrollableParent = findScrollableParent(this);\n      var parentRects = scrollableParent.getBoundingClientRect();\n      var clientRects = this.getBoundingClientRect();\n\n      if (scrollableParent !== d.body) {\n        // reveal element inside parent\n        smoothScroll.call(\n          this,\n          scrollableParent,\n          scrollableParent.scrollLeft + clientRects.left - parentRects.left,\n          scrollableParent.scrollTop + clientRects.top - parentRects.top\n        );\n\n        // reveal parent in viewport unless is fixed\n        if (w.getComputedStyle(scrollableParent).position !== 'fixed') {\n          w.scrollBy({\n            left: parentRects.left,\n            top: parentRects.top,\n            behavior: 'smooth'\n          });\n        }\n      } else {\n        // reveal element in viewport\n        w.scrollBy({\n          left: clientRects.left,\n          top: clientRects.top,\n          behavior: 'smooth'\n        });\n      }\n    };\n  }\n\n  if (typeof exports === 'object' && typeof module !== 'undefined') {\n    // commonjs\n    module.exports = { polyfill: polyfill };\n  } else {\n    // global\n    polyfill();\n  }\n\n}());\n","import {\n  playerConfig,\n  actionWithDelay,\n  eventWithTime,\n  EventType,\n  IncrementalSource,\n} from '../types';\n\nexport class Timer {\n  public timeOffset: number = 0;\n\n  private actions: actionWithDelay[];\n  private config: playerConfig;\n  private raf: number;\n\n  constructor(config: playerConfig, actions: actionWithDelay[] = []) {\n    this.actions = actions;\n    this.config = config;\n  }\n  /**\n   * Add an action after the timer starts.\n   * @param action\n   */\n  public addAction(action: actionWithDelay) {\n    const index = this.findActionIndex(action);\n    this.actions.splice(index, 0, action);\n  }\n  /**\n   * Add all actions before the timer starts\n   * @param actions\n   */\n  public addActions(actions: actionWithDelay[]) {\n    this.actions.push(...actions);\n  }\n\n  public start() {\n    this.actions.sort((a1, a2) => a1.delay - a2.delay);\n    this.timeOffset = 0;\n    let lastTimestamp = performance.now();\n    const { actions, config } = this;\n    const self = this;\n    function check(time: number) {\n      self.timeOffset += (time - lastTimestamp) * config.speed;\n      lastTimestamp = time;\n      while (actions.length) {\n        const action = actions[0];\n        if (self.timeOffset >= action.delay) {\n          actions.shift();\n          action.doAction();\n        } else {\n          break;\n        }\n      }\n      if (actions.length > 0 || self.config.liveMode) {\n        self.raf = requestAnimationFrame(check);\n      }\n    }\n    this.raf = requestAnimationFrame(check);\n  }\n\n  public clear() {\n    if (this.raf) {\n      cancelAnimationFrame(this.raf);\n    }\n    this.actions.length = 0;\n  }\n\n  private findActionIndex(action: actionWithDelay): number {\n    let start = 0;\n    let end = this.actions.length - 1;\n    while (start <= end) {\n      let mid = Math.floor((start + end) / 2);\n      if (this.actions[mid].delay < action.delay) {\n        start = mid + 1;\n      } else if (this.actions[mid].delay > action.delay) {\n        end = mid - 1;\n      } else {\n        return mid;\n      }\n    }\n    return start;\n  }\n}\n\n// TODO: add speed to mouse move timestamp calculation\nexport function getDelay(event: eventWithTime, baselineTime: number): number {\n  // Mouse move events was recorded in a throttle function,\n  // so we need to find the real timestamp by traverse the time offsets.\n  if (\n    event.type === EventType.IncrementalSnapshot &&\n    event.data.source === IncrementalSource.MouseMove\n  ) {\n    const firstOffset = event.data.positions[0].timeOffset;\n    // timeOffset is a negative offset to event.timestamp\n    const firstTimestamp = event.timestamp + firstOffset;\n    event.delay = firstTimestamp - baselineTime;\n    return firstTimestamp - baselineTime;\n  }\n  event.delay = event.timestamp - baselineTime;\n  return event.timestamp - baselineTime;\n}\n","/*! *****************************************************************************\nCopyright (c) Microsoft Corporation. All rights reserved.\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\nthis file except in compliance with the License. You may obtain a copy of the\nLicense at http://www.apache.org/licenses/LICENSE-2.0\n\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\nMERCHANTABLITY OR NON-INFRINGEMENT.\n\nSee the Apache Version 2.0 License for specific language governing permissions\nand limitations under the License.\n***************************************************************************** */\nvar t;!function(t){t[t.NotStarted=0]=\"NotStarted\",t[t.Running=1]=\"Running\",t[t.Stopped=2]=\"Stopped\"}(t||(t={}));var n={type:\"xstate.init\"};function e(t){return void 0===t?[]:[].concat(t)}function r(t){return{type:\"xstate.assign\",assignment:t}}function i(t,n){return\"string\"==typeof(t=\"string\"==typeof t&&n&&n[t]?n[t]:t)?{type:t}:\"function\"==typeof t?{type:t.name,exec:t}:t}function o(t){return function(n){return t===n}}function a(t){return\"string\"==typeof t?{type:t}:t}function u(t,n){return{value:t,context:n,actions:[],changed:!1,matches:o(t)}}function c(t,n){void 0===n&&(n={});var r={config:t,_options:n,initialState:{value:t.initial,actions:e(t.states[t.initial].entry).map((function(t){return i(t,n.actions)})),context:t.context,matches:o(t.initial)},transition:function(n,c){var s,f,l=\"string\"==typeof n?{value:n,context:t.context}:n,v=l.value,p=l.context,g=a(c),y=t.states[v];if(y.on){var d=e(y.on[g.type]),x=function(n){if(void 0===n)return{value:u(v,p)};var e=\"string\"==typeof n?{target:n}:n,a=e.target,c=void 0===a?v:a,s=e.actions,f=void 0===s?[]:s,l=e.cond,d=p;if((void 0===l?function(){return!0}:l)(p,g)){var x=t.states[c],m=!1,h=[].concat(y.exit,f,x.entry).filter((function(t){return t})).map((function(t){return i(t,r._options.actions)})).filter((function(t){if(\"xstate.assign\"===t.type){m=!0;var n=Object.assign({},d);return\"function\"==typeof t.assignment?n=t.assignment(d,g):Object.keys(t.assignment).forEach((function(e){n[e]=\"function\"==typeof t.assignment[e]?t.assignment[e](d,g):t.assignment[e]})),d=n,!1}return!0}));return{value:{value:c,context:d,actions:h,changed:c!==v||h.length>0||m,matches:o(c)}}}};try{for(var m=function(t){var n=\"function\"==typeof Symbol&&t[Symbol.iterator],e=0;return n?n.call(t):{next:function(){return t&&e>=t.length&&(t=void 0),{value:t&&t[e++],done:!t}}}}(d),h=m.next();!h.done;h=m.next()){var S=x(h.value);if(\"object\"==typeof S)return S.value}}catch(t){s={error:t}}finally{try{h&&!h.done&&(f=m.return)&&f.call(m)}finally{if(s)throw s.error}}}return u(v,p)}};return r}var s=function(t,n){return t.actions.forEach((function(e){var r=e.exec;return r&&r(t.context,n)}))};function f(e){var r=e.initialState,i=t.NotStarted,o=new Set,u={_machine:e,send:function(n){i===t.Running&&(r=e.transition(r,n),s(r,a(n)),o.forEach((function(t){return t(r)})))},subscribe:function(t){return o.add(t),t(r),{unsubscribe:function(){return o.delete(t)}}},start:function(){return i=t.Running,s(r,n),u},stop:function(){return i=t.Stopped,o.clear(),u},get state(){return r},get status(){return i}};return u}export{t as InterpreterStatus,r as assign,c as createMachine,f as interpret};\n","import { createMachine, interpret, assign } from '@xstate/fsm';\nimport {\n  playerConfig,\n  eventWithTime,\n  actionWithDelay,\n  ReplayerEvents,\n  Emitter,\n} from '../types';\nimport { Timer, getDelay } from './timer';\n\nexport type PlayerContext = {\n  events: eventWithTime[];\n  timer: Timer;\n  speed: playerConfig['speed'];\n  timeOffset: number;\n  baselineTime: number;\n  lastPlayedEvent: eventWithTime | null;\n};\nexport type PlayerEvent =\n  | {\n      type: 'PLAY';\n      payload: {\n        timeOffset: number;\n      };\n    }\n  | {\n      type: 'CAST_EVENT';\n      payload: {\n        event: eventWithTime;\n      };\n    }\n  | { type: 'PAUSE' }\n  | {\n      type: 'RESUME';\n      payload: {\n        timeOffset: number;\n      };\n    }\n  | { type: 'END' }\n  | { type: 'REPLAY' }\n  | { type: 'FAST_FORWARD' }\n  | { type: 'BACK_TO_NORMAL' }\n  | { type: 'TO_LIVE'; payload: { baselineTime?: number } }\n  | {\n      type: 'ADD_EVENT';\n      payload: {\n        event: eventWithTime;\n      };\n    };\nexport type PlayerState =\n  | {\n      value: 'inited';\n      context: PlayerContext;\n    }\n  | {\n      value: 'playing';\n      context: PlayerContext;\n    }\n  | {\n      value: 'paused';\n      context: PlayerContext;\n    }\n  | {\n      value: 'ended';\n      context: PlayerContext;\n    }\n  | {\n      value: 'skipping';\n      context: PlayerContext;\n    }\n  | {\n      value: 'live';\n      context: PlayerContext;\n    };\n\ntype PlayerAssets = {\n  emitter: Emitter;\n  getCastFn(event: eventWithTime, isSync: boolean): () => void;\n};\nexport function createPlayerService(\n  context: PlayerContext,\n  { getCastFn, emitter }: PlayerAssets,\n) {\n  const playerMachine = createMachine<PlayerContext, PlayerEvent, PlayerState>(\n    {\n      id: 'player',\n      context,\n      initial: 'inited',\n      states: {\n        inited: {\n          on: {\n            PLAY: {\n              target: 'playing',\n              actions: ['recordTimeOffset', 'play'],\n            },\n            TO_LIVE: {\n              target: 'live',\n              actions: ['startLive'],\n            },\n          },\n        },\n        playing: {\n          on: {\n            PAUSE: {\n              target: 'paused',\n              actions: ['pause'],\n            },\n            END: 'ended',\n            FAST_FORWARD: 'skipping',\n            CAST_EVENT: {\n              target: 'playing',\n              actions: 'castEvent',\n            },\n          },\n        },\n        paused: {\n          on: {\n            RESUME: {\n              target: 'playing',\n              actions: ['recordTimeOffset', 'play'],\n            },\n            CAST_EVENT: {\n              target: 'paused',\n              actions: 'castEvent',\n            },\n          },\n        },\n        skipping: {\n          on: {\n            BACK_TO_NORMAL: 'playing',\n          },\n        },\n        ended: {\n          on: {\n            REPLAY: 'playing',\n          },\n        },\n        live: {\n          on: {\n            ADD_EVENT: {\n              target: 'live',\n              actions: ['addEvent'],\n            },\n          },\n        },\n      },\n    },\n    {\n      actions: {\n        castEvent: assign({\n          lastPlayedEvent: (ctx, event) => {\n            if (event.type === 'CAST_EVENT') {\n              return event.payload.event;\n            }\n            return context.lastPlayedEvent;\n          },\n        }),\n        recordTimeOffset: assign((ctx, event) => {\n          let timeOffset = ctx.timeOffset;\n          if ('payload' in event && 'timeOffset' in event.payload) {\n            timeOffset = event.payload.timeOffset;\n          }\n          return {\n            ...ctx,\n            timeOffset,\n            baselineTime: ctx.events[0].timestamp + timeOffset,\n          };\n        }),\n        play(ctx) {\n          const { timer, events, baselineTime, lastPlayedEvent } = ctx;\n          timer.clear();\n          const actions = new Array<actionWithDelay>();\n          for (const event of events) {\n            if (\n              lastPlayedEvent &&\n              (event.timestamp <= lastPlayedEvent.timestamp ||\n                event === lastPlayedEvent)\n            ) {\n              continue;\n            }\n            const isSync = event.timestamp < baselineTime;\n            const castFn = getCastFn(event, isSync);\n            if (isSync) {\n              castFn();\n            } else {\n              actions.push({\n                doAction: () => {\n                  castFn();\n                  emitter.emit(ReplayerEvents.EventCast, event);\n                },\n                delay: getDelay(event, baselineTime),\n              });\n            }\n          }\n          timer.addActions(actions);\n          timer.start();\n        },\n        pause(ctx) {\n          ctx.timer.clear();\n        },\n        startLive: assign({\n          baselineTime: (ctx, event) => {\n            ctx.timer.start();\n            if (event.type === 'TO_LIVE' && event.payload.baselineTime) {\n              return event.payload.baselineTime;\n            }\n            return Date.now();\n          },\n        }),\n        addEvent: assign((ctx, machineEvent) => {\n          const { baselineTime, timer, events } = ctx;\n          if (machineEvent.type === 'ADD_EVENT') {\n            const { event } = machineEvent.payload;\n            events.push(event);\n            const isSync = event.timestamp < baselineTime;\n            const castFn = getCastFn(event, isSync);\n            if (isSync) {\n              castFn();\n            } else {\n              timer.addAction({\n                doAction: () => {\n                  castFn();\n                  emitter.emit(ReplayerEvents.EventCast, event);\n                },\n                delay: getDelay(event, baselineTime),\n              });\n            }\n          }\n          return { ...ctx, events };\n        }),\n      },\n    },\n  );\n  return interpret(playerMachine);\n}\n","import {\n  Mirror,\n  throttleOptions,\n  listenerHandler,\n  hookResetter,\n  blockClass,\n} from './types';\nimport { INode } from 'rrweb-snapshot';\n\nexport function on(\n  type: string,\n  fn: EventListenerOrEventListenerObject,\n  target: Document | Window = document,\n): listenerHandler {\n  const options = { capture: true, passive: true };\n  target.addEventListener(type, fn, options);\n  return () => target.removeEventListener(type, fn, options);\n}\n\nexport const mirror: Mirror = {\n  map: {},\n  getId(n) {\n    // if n is not a serialized INode, use -1 as its id.\n    if (!n.__sn) {\n      return -1;\n    }\n    return n.__sn.id;\n  },\n  getNode(id) {\n    return mirror.map[id] || null;\n  },\n  // TODO: use a weakmap to get rid of manually memory management\n  removeNodeFromMap(n) {\n    const id = n.__sn && n.__sn.id;\n    delete mirror.map[id];\n    if (n.childNodes) {\n      n.childNodes.forEach((child) =>\n        mirror.removeNodeFromMap((child as Node) as INode),\n      );\n    }\n  },\n  has(id) {\n    return mirror.map.hasOwnProperty(id);\n  },\n};\n\n// copy from underscore and modified\nexport function throttle<T>(\n  func: (arg: T) => void,\n  wait: number,\n  options: throttleOptions = {},\n) {\n  let timeout: number | null = null;\n  let previous = 0;\n  // tslint:disable-next-line: only-arrow-functions\n  return function (arg: T) {\n    let now = Date.now();\n    if (!previous && options.leading === false) {\n      previous = now;\n    }\n    let remaining = wait - (now - previous);\n    let context = this;\n    let args = arguments;\n    if (remaining <= 0 || remaining > wait) {\n      if (timeout) {\n        window.clearTimeout(timeout);\n        timeout = null;\n      }\n      previous = now;\n      func.apply(context, args);\n    } else if (!timeout && options.trailing !== false) {\n      timeout = window.setTimeout(() => {\n        previous = options.leading === false ? 0 : Date.now();\n        timeout = null;\n        func.apply(context, args);\n      }, remaining);\n    }\n  };\n}\n\nexport function hookSetter<T>(\n  target: T,\n  key: string | number | symbol,\n  d: PropertyDescriptor,\n  isRevoked?: boolean,\n  win = window,\n): hookResetter {\n  const original = win.Object.getOwnPropertyDescriptor(target, key);\n  win.Object.defineProperty(\n    target,\n    key,\n    isRevoked\n      ? d\n      : {\n          set(value) {\n            // put hooked setter into event loop to avoid of set latency\n            setTimeout(() => {\n              d.set!.call(this, value);\n            }, 0);\n            if (original && original.set) {\n              original.set.call(this, value);\n            }\n          },\n        },\n  );\n  return () => hookSetter(target, key, original || {}, true);\n}\n\nexport function getWindowHeight(): number {\n  return (\n    window.innerHeight ||\n    (document.documentElement && document.documentElement.clientHeight) ||\n    (document.body && document.body.clientHeight)\n  );\n}\n\nexport function getWindowWidth(): number {\n  return (\n    window.innerWidth ||\n    (document.documentElement && document.documentElement.clientWidth) ||\n    (document.body && document.body.clientWidth)\n  );\n}\n\nexport function isBlocked(node: Node | null, blockClass: blockClass): boolean {\n  if (!node) {\n    return false;\n  }\n  if (node.nodeType === node.ELEMENT_NODE) {\n    let needBlock = false;\n    if (typeof blockClass === 'string') {\n      needBlock = (node as HTMLElement).classList.contains(blockClass);\n    } else {\n      (node as HTMLElement).classList.forEach((className) => {\n        if (blockClass.test(className)) {\n          needBlock = true;\n        }\n      });\n    }\n    return needBlock || isBlocked(node.parentNode, blockClass);\n  }\n  return isBlocked(node.parentNode, blockClass);\n}\n\nexport function isAncestorRemoved(target: INode): boolean {\n  const id = mirror.getId(target);\n  if (!mirror.has(id)) {\n    return true;\n  }\n  if (\n    target.parentNode &&\n    target.parentNode.nodeType === target.DOCUMENT_NODE\n  ) {\n    return false;\n  }\n  // if the root is not document, it means the node is not in the DOM tree anymore\n  if (!target.parentNode) {\n    return true;\n  }\n  return isAncestorRemoved((target.parentNode as unknown) as INode);\n}\n\nexport function isTouchEvent(\n  event: MouseEvent | TouchEvent,\n): event is TouchEvent {\n  return Boolean((event as TouchEvent).changedTouches);\n}\n\nexport function polyfill() {\n  if ('NodeList' in window && !NodeList.prototype.forEach) {\n    NodeList.prototype.forEach = (Array.prototype\n      .forEach as unknown) as NodeList['forEach'];\n  }\n}\n","const rules: (blockClass: string) => string[] = (blockClass: string) => [\n  `iframe, .${blockClass} { background: #ccc }`,\n  'noscript { display: none !important; }',\n];\n\nexport default rules;\n","import { rebuild, buildNodeWithSN } from 'rrweb-snapshot';\nimport * as mittProxy from 'mitt';\nimport * as smoothscroll from 'smoothscroll-polyfill';\nimport { Timer } from './timer';\nimport { createPlayerService } from './machine';\nimport {\n  EventType,\n  IncrementalSource,\n  fullSnapshotEvent,\n  eventWithTime,\n  MouseInteractions,\n  playerConfig,\n  playerMetaData,\n  viewportResizeDimention,\n  missingNodeMap,\n  addedNodeMutation,\n  missingNode,\n  incrementalSnapshotEvent,\n  incrementalData,\n  ReplayerEvents,\n  Handler,\n  Emitter,\n  MediaInteractions,\n  metaEvent,\n} from '../types';\nimport { mirror, polyfill } from '../utils';\nimport getInjectStyleRules from './styles/inject-style';\nimport './styles/style.css';\n\nconst SKIP_TIME_THRESHOLD = 10 * 1000;\nconst SKIP_TIME_INTERVAL = 5 * 1000;\n\n// https://github.com/rollup/rollup/issues/1267#issuecomment-296395734\n// tslint:disable-next-line\nconst mitt = (mittProxy as any).default || mittProxy;\n\nconst REPLAY_CONSOLE_PREFIX = '[replayer]';\n\nconst defaultConfig: playerConfig = {\n  speed: 1,\n  root: document.body,\n  loadTimeout: 0,\n  skipInactive: false,\n  showWarning: true,\n  showDebug: false,\n  blockClass: 'rr-block',\n  liveMode: false,\n  insertStyleRules: [],\n  triggerFocus: true,\n};\n\nexport class Replayer {\n  public wrapper: HTMLDivElement;\n  public iframe: HTMLIFrameElement;\n\n  public get timer() {\n    return this.service.state.context.timer;\n  }\n\n  private config: playerConfig;\n\n  private mouse: HTMLDivElement;\n\n  private emitter: Emitter = mitt();\n\n  private nextUserInteractionEvent: eventWithTime | null;\n  private noramlSpeed: number = -1;\n\n  // tslint:disable-next-line: variable-name\n  private legacy_missingNodeRetryMap: missingNodeMap = {};\n\n  private service!: ReturnType<typeof createPlayerService>;\n\n  constructor(\n    events: Array<eventWithTime | string>,\n    config?: Partial<playerConfig>,\n  ) {\n    if (!config?.liveMode && events.length < 2) {\n      throw new Error('Replayer need at least 2 events.');\n    }\n    this.config = Object.assign({}, defaultConfig, config);\n\n    this.handleResize = this.handleResize.bind(this);\n    this.getCastFn = this.getCastFn.bind(this);\n    this.emitter.on('resize', this.handleResize as Handler);\n\n    smoothscroll.polyfill();\n    polyfill();\n    this.setupDom();\n\n    this.service = createPlayerService(\n      {\n        events: events.map((e) => {\n          if (config && config.unpackFn) {\n            return config.unpackFn(e as string);\n          }\n          return e as eventWithTime;\n        }),\n        timer: new Timer(this.config),\n        speed: config?.speed || defaultConfig.speed,\n        timeOffset: 0,\n        baselineTime: 0,\n        lastPlayedEvent: null,\n      },\n      {\n        getCastFn: this.getCastFn,\n        emitter: this.emitter,\n      },\n    );\n    this.service.start();\n    this.service.subscribe((state) => {\n      if (!state.changed) {\n        return;\n      }\n      // publish via emitter\n    });\n\n    // rebuild first full snapshot as the poster of the player\n    // maybe we can cache it for performance optimization\n    const { events: contextEvents } = this.service.state.context;\n    const firstMeta = contextEvents.find((e) => e.type === EventType.Meta);\n    const firstFullsnapshot = contextEvents.find(\n      (e) => e.type === EventType.FullSnapshot,\n    );\n    if (firstMeta) {\n      const { width, height } = firstMeta.data as metaEvent['data'];\n      this.emitter.emit(ReplayerEvents.Resize, {\n        width,\n        height,\n      });\n    }\n    if (firstFullsnapshot) {\n      this.rebuildFullSnapshot(\n        firstFullsnapshot as fullSnapshotEvent & { timestamp: number },\n      );\n    }\n  }\n\n  public on(event: string, handler: Handler) {\n    this.emitter.on(event, handler);\n  }\n\n  public setConfig(config: Partial<playerConfig>) {\n    Object.keys(config).forEach((key) => {\n      // @ts-ignore\n      this.config[key] = config[key];\n    });\n    if (!this.config.skipInactive) {\n      this.noramlSpeed = -1;\n    }\n  }\n\n  public getMetaData(): playerMetaData {\n    const { events } = this.service.state.context;\n    const firstEvent = events[0];\n    const lastEvent = events[events.length - 1];\n    return {\n      totalTime: lastEvent.timestamp - firstEvent.timestamp,\n    };\n  }\n\n  public getCurrentTime(): number {\n    return this.timer.timeOffset + this.getTimeOffset();\n  }\n\n  public getTimeOffset(): number {\n    const { baselineTime, events } = this.service.state.context;\n    return baselineTime - events[0].timestamp;\n  }\n\n  /**\n   * This API was designed to be used as play at any time offset.\n   * Since we minimized the data collected from recorder, we do not\n   * have the ability of undo an event.\n   * So the implementation of play at any time offset will always iterate\n   * all of the events, cast event before the offset synchronously\n   * and cast event after the offset asynchronously with timer.\n   * @param timeOffset number\n   */\n  public play(timeOffset = 0) {\n    this.service.send({ type: 'PLAY', payload: { timeOffset } });\n    this.emitter.emit(ReplayerEvents.Start);\n  }\n\n  public pause() {\n    this.service.send({ type: 'PAUSE' });\n    this.emitter.emit(ReplayerEvents.Pause);\n  }\n\n  public resume(timeOffset = 0) {\n    this.service.send({ type: 'RESUME', payload: { timeOffset } });\n    this.emitter.emit(ReplayerEvents.Resume);\n  }\n\n  public startLive(baselineTime?: number) {\n    this.service.send({ type: 'TO_LIVE', payload: { baselineTime } });\n  }\n\n  public addEvent(rawEvent: eventWithTime | string) {\n    const event = this.config.unpackFn\n      ? this.config.unpackFn(rawEvent as string)\n      : (rawEvent as eventWithTime);\n    Promise.resolve().then(() =>\n      this.service.send({ type: 'ADD_EVENT', payload: { event } }),\n    );\n  }\n\n  public enableInteract() {\n    this.iframe.setAttribute('scrolling', 'auto');\n    this.iframe.style.pointerEvents = 'auto';\n  }\n\n  public disableInteract() {\n    this.iframe.setAttribute('scrolling', 'no');\n    this.iframe.style.pointerEvents = 'none';\n  }\n\n  private setupDom() {\n    this.wrapper = document.createElement('div');\n    this.wrapper.classList.add('replayer-wrapper');\n    this.config.root!.appendChild(this.wrapper);\n\n    this.mouse = document.createElement('div');\n    this.mouse.classList.add('replayer-mouse');\n    this.wrapper.appendChild(this.mouse);\n\n    this.iframe = document.createElement('iframe');\n    this.iframe.setAttribute('sandbox', 'allow-same-origin');\n    this.disableInteract();\n    this.wrapper.appendChild(this.iframe);\n  }\n\n  private handleResize(dimension: viewportResizeDimention) {\n    this.iframe.setAttribute('width', String(dimension.width));\n    this.iframe.setAttribute('height', String(dimension.height));\n  }\n\n  private getCastFn(event: eventWithTime, isSync = false) {\n    const { events } = this.service.state.context;\n    let castFn: undefined | (() => void);\n    switch (event.type) {\n      case EventType.DomContentLoaded:\n      case EventType.Load:\n        break;\n      case EventType.Custom:\n        castFn = () => {\n          /**\n           * emit custom-event and pass the event object.\n           *\n           * This will add more value to the custom event and allows the client to react for custom-event.\n           */\n          this.emitter.emit(ReplayerEvents.CustomEvent, event);\n        };\n        break;\n      case EventType.Meta:\n        castFn = () =>\n          this.emitter.emit(ReplayerEvents.Resize, {\n            width: event.data.width,\n            height: event.data.height,\n          });\n        break;\n      case EventType.FullSnapshot:\n        castFn = () => {\n          this.rebuildFullSnapshot(event);\n          this.iframe.contentWindow!.scrollTo(event.data.initialOffset);\n        };\n        break;\n      case EventType.IncrementalSnapshot:\n        castFn = () => {\n          this.applyIncremental(event, isSync);\n          if (event === this.nextUserInteractionEvent) {\n            this.nextUserInteractionEvent = null;\n            this.restoreSpeed();\n          }\n          if (this.config.skipInactive && !this.nextUserInteractionEvent) {\n            for (const _event of events) {\n              if (_event.timestamp! <= event.timestamp!) {\n                continue;\n              }\n              if (this.isUserInteraction(_event)) {\n                if (\n                  _event.delay! - event.delay! >\n                  SKIP_TIME_THRESHOLD * this.config.speed\n                ) {\n                  this.nextUserInteractionEvent = _event;\n                }\n                break;\n              }\n            }\n            if (this.nextUserInteractionEvent) {\n              this.noramlSpeed = this.config.speed;\n              const skipTime =\n                this.nextUserInteractionEvent.delay! - event.delay!;\n              const payload = {\n                speed: Math.min(Math.round(skipTime / SKIP_TIME_INTERVAL), 360),\n              };\n              this.setConfig(payload);\n              this.emitter.emit(ReplayerEvents.SkipStart, payload);\n            }\n          }\n        };\n        break;\n      default:\n    }\n    const wrappedCastFn = () => {\n      if (castFn) {\n        castFn();\n      }\n      this.service.send({ type: 'CAST_EVENT', payload: { event } });\n      if (event === events[events.length - 1]) {\n        this.restoreSpeed();\n        this.service.send('END');\n        this.emitter.emit(ReplayerEvents.Finish);\n      }\n    };\n    return wrappedCastFn;\n  }\n\n  private rebuildFullSnapshot(\n    event: fullSnapshotEvent & { timestamp: number },\n  ) {\n    if (Object.keys(this.legacy_missingNodeRetryMap).length) {\n      console.warn(\n        'Found unresolved missing node map',\n        this.legacy_missingNodeRetryMap,\n      );\n    }\n    this.legacy_missingNodeRetryMap = {};\n    mirror.map = rebuild(event.data.node, this.iframe.contentDocument!)[1];\n    const styleEl = document.createElement('style');\n    const { documentElement, head } = this.iframe.contentDocument!;\n    documentElement!.insertBefore(styleEl, head);\n    const injectStylesRules = getInjectStyleRules(\n      this.config.blockClass,\n    ).concat(this.config.insertStyleRules);\n    for (let idx = 0; idx < injectStylesRules.length; idx++) {\n      (styleEl.sheet! as CSSStyleSheet).insertRule(injectStylesRules[idx], idx);\n    }\n    this.emitter.emit(ReplayerEvents.FullsnapshotRebuilded);\n    this.waitForStylesheetLoad();\n  }\n\n  /**\n   * pause when loading style sheet, resume when loaded all timeout exceed\n   */\n  private waitForStylesheetLoad() {\n    const { head } = this.iframe.contentDocument!;\n    if (head) {\n      const unloadSheets: Set<HTMLLinkElement> = new Set();\n      let timer: number;\n      let beforeLoadState = this.service.state;\n      head\n        .querySelectorAll('link[rel=\"stylesheet\"]')\n        .forEach((css: HTMLLinkElement) => {\n          if (!css.sheet) {\n            unloadSheets.add(css);\n            css.addEventListener('load', () => {\n              unloadSheets.delete(css);\n              // all loaded and timer not released yet\n              if (unloadSheets.size === 0 && timer !== -1) {\n                if (beforeLoadState.matches('playing')) {\n                  this.resume(this.getCurrentTime());\n                }\n                this.emitter.emit(ReplayerEvents.LoadStylesheetEnd);\n                if (timer) {\n                  window.clearTimeout(timer);\n                }\n              }\n            });\n          }\n        });\n\n      if (unloadSheets.size > 0) {\n        // find some unload sheets after iterate\n        this.service.send({ type: 'PAUSE' });\n        this.emitter.emit(ReplayerEvents.LoadStylesheetStart);\n        timer = window.setTimeout(() => {\n          if (beforeLoadState.matches('playing')) {\n            this.resume(this.getCurrentTime());\n          }\n          // mark timer was called\n          timer = -1;\n        }, this.config.loadTimeout);\n      }\n    }\n  }\n\n  private applyIncremental(\n    e: incrementalSnapshotEvent & { timestamp: number },\n    isSync: boolean,\n  ) {\n    const { baselineTime } = this.service.state.context;\n    const { data: d } = e;\n    switch (d.source) {\n      case IncrementalSource.Mutation: {\n        d.removes.forEach((mutation) => {\n          const target = mirror.getNode(mutation.id);\n          if (!target) {\n            return this.warnNodeNotFound(d, mutation.id);\n          }\n          const parent = mirror.getNode(mutation.parentId);\n          if (!parent) {\n            return this.warnNodeNotFound(d, mutation.parentId);\n          }\n          // target may be removed with its parents before\n          mirror.removeNodeFromMap(target);\n          if (parent) {\n            parent.removeChild(target);\n          }\n        });\n\n        const legacy_missingNodeMap: missingNodeMap = {\n          ...this.legacy_missingNodeRetryMap,\n        };\n        const queue: addedNodeMutation[] = [];\n\n        const appendNode = (mutation: addedNodeMutation) => {\n          const parent = mirror.getNode(mutation.parentId);\n          if (!parent) {\n            return queue.push(mutation);\n          }\n\n          let previous: Node | null = null;\n          let next: Node | null = null;\n          if (mutation.previousId) {\n            previous = mirror.getNode(mutation.previousId) as Node;\n          }\n          if (mutation.nextId) {\n            next = mirror.getNode(mutation.nextId) as Node;\n          }\n          // next not present at this moment\n          if (mutation.nextId !== null && mutation.nextId !== -1 && !next) {\n            return queue.push(mutation);\n          }\n\n          const target = buildNodeWithSN(\n            mutation.node,\n            this.iframe.contentDocument!,\n            mirror.map,\n            true,\n          ) as Node;\n\n          // legacy data, we should not have -1 siblings any more\n          if (mutation.previousId === -1 || mutation.nextId === -1) {\n            legacy_missingNodeMap[mutation.node.id] = {\n              node: target,\n              mutation,\n            };\n            return;\n          }\n\n          if (\n            previous &&\n            previous.nextSibling &&\n            previous.nextSibling.parentNode\n          ) {\n            parent.insertBefore(target, previous.nextSibling);\n          } else if (next && next.parentNode) {\n            // making sure the parent contains the reference nodes\n            // before we insert target before next.\n            parent.contains(next)\n              ? parent.insertBefore(target, next)\n              : parent.insertBefore(target, null);\n          } else {\n            parent.appendChild(target);\n          }\n\n          if (mutation.previousId || mutation.nextId) {\n            this.legacy_resolveMissingNode(\n              legacy_missingNodeMap,\n              parent,\n              target,\n              mutation,\n            );\n          }\n        };\n\n        d.adds.forEach((mutation) => {\n          appendNode(mutation);\n        });\n\n        while (queue.length) {\n          if (queue.every((m) => !Boolean(mirror.getNode(m.parentId)))) {\n            return queue.forEach((m) => this.warnNodeNotFound(d, m.node.id));\n          }\n          const mutation = queue.shift()!;\n          appendNode(mutation);\n        }\n\n        if (Object.keys(legacy_missingNodeMap).length) {\n          Object.assign(this.legacy_missingNodeRetryMap, legacy_missingNodeMap);\n        }\n\n        d.texts.forEach((mutation) => {\n          const target = mirror.getNode(mutation.id);\n          if (!target) {\n            return this.warnNodeNotFound(d, mutation.id);\n          }\n          target.textContent = mutation.value;\n        });\n        d.attributes.forEach((mutation) => {\n          const target = mirror.getNode(mutation.id);\n          if (!target) {\n            return this.warnNodeNotFound(d, mutation.id);\n          }\n          for (const attributeName in mutation.attributes) {\n            if (typeof attributeName === 'string') {\n              const value = mutation.attributes[attributeName];\n              if (value !== null) {\n                ((target as Node) as Element).setAttribute(\n                  attributeName,\n                  value,\n                );\n              } else {\n                ((target as Node) as Element).removeAttribute(attributeName);\n              }\n            }\n          }\n        });\n        break;\n      }\n      case IncrementalSource.MouseMove:\n        if (isSync) {\n          const lastPosition = d.positions[d.positions.length - 1];\n          this.moveAndHover(d, lastPosition.x, lastPosition.y, lastPosition.id);\n        } else {\n          d.positions.forEach((p) => {\n            const action = {\n              doAction: () => {\n                this.moveAndHover(d, p.x, p.y, p.id);\n              },\n              delay: p.timeOffset + e.timestamp - baselineTime,\n            };\n            this.timer.addAction(action);\n          });\n        }\n        break;\n      case IncrementalSource.MouseInteraction: {\n        /**\n         * Same as the situation of missing input target.\n         */\n        if (d.id === -1) {\n          break;\n        }\n        const event = new Event(MouseInteractions[d.type].toLowerCase());\n        const target = mirror.getNode(d.id);\n        if (!target) {\n          return this.debugNodeNotFound(d, d.id);\n        }\n        this.emitter.emit(ReplayerEvents.MouseInteraction, {\n          type: d.type,\n          target,\n        });\n        const { triggerFocus } = this.config;\n        switch (d.type) {\n          case MouseInteractions.Blur:\n            if ('blur' in ((target as Node) as HTMLElement)) {\n              ((target as Node) as HTMLElement).blur();\n            }\n            break;\n          case MouseInteractions.Focus:\n            if (triggerFocus && ((target as Node) as HTMLElement).focus) {\n              ((target as Node) as HTMLElement).focus({\n                preventScroll: true,\n              });\n            }\n            break;\n          case MouseInteractions.Click:\n          case MouseInteractions.TouchStart:\n          case MouseInteractions.TouchEnd:\n            /**\n             * Click has no visual impact when replaying and may\n             * trigger navigation when apply to an <a> link.\n             * So we will not call click(), instead we add an\n             * animation to the mouse element which indicate user\n             * clicked at this moment.\n             */\n            if (!isSync) {\n              this.moveAndHover(d, d.x, d.y, d.id);\n              this.mouse.classList.remove('active');\n              // tslint:disable-next-line\n              void this.mouse.offsetWidth;\n              this.mouse.classList.add('active');\n            }\n            break;\n          default:\n            target.dispatchEvent(event);\n        }\n        break;\n      }\n      case IncrementalSource.Scroll: {\n        /**\n         * Same as the situation of missing input target.\n         */\n        if (d.id === -1) {\n          break;\n        }\n        const target = mirror.getNode(d.id);\n        if (!target) {\n          return this.debugNodeNotFound(d, d.id);\n        }\n        if ((target as Node) === this.iframe.contentDocument) {\n          this.iframe.contentWindow!.scrollTo({\n            top: d.y,\n            left: d.x,\n            behavior: isSync ? 'auto' : 'smooth',\n          });\n        } else {\n          try {\n            ((target as Node) as Element).scrollTop = d.y;\n            ((target as Node) as Element).scrollLeft = d.x;\n          } catch (error) {\n            /**\n             * Seldomly we may found scroll target was removed before\n             * its last scroll event.\n             */\n          }\n        }\n        break;\n      }\n      case IncrementalSource.ViewportResize:\n        this.emitter.emit(ReplayerEvents.Resize, {\n          width: d.width,\n          height: d.height,\n        });\n        break;\n      case IncrementalSource.Input: {\n        /**\n         * Input event on an unserialized node usually means the event\n         * was synchrony triggered programmatically after the node was\n         * created. This means there was not an user observable interaction\n         * and we do not need to replay it.\n         */\n        if (d.id === -1) {\n          break;\n        }\n        const target = mirror.getNode(d.id);\n        if (!target) {\n          return this.debugNodeNotFound(d, d.id);\n        }\n        try {\n          ((target as Node) as HTMLInputElement).checked = d.isChecked;\n          ((target as Node) as HTMLInputElement).value = d.text;\n        } catch (error) {\n          // for safe\n        }\n        break;\n      }\n      case IncrementalSource.MediaInteraction: {\n        const target = mirror.getNode(d.id);\n        if (!target) {\n          return this.debugNodeNotFound(d, d.id);\n        }\n        const mediaEl = (target as Node) as HTMLMediaElement;\n        if (d.type === MediaInteractions.Pause) {\n          mediaEl.pause();\n        }\n        if (d.type === MediaInteractions.Play) {\n          if (mediaEl.readyState >= HTMLMediaElement.HAVE_CURRENT_DATA) {\n            mediaEl.play();\n          } else {\n            mediaEl.addEventListener('canplay', () => {\n              mediaEl.play();\n            });\n          }\n        }\n        break;\n      }\n      case IncrementalSource.StyleSheetRule: {\n        const target = mirror.getNode(d.id);\n        if (!target) {\n          return this.debugNodeNotFound(d, d.id);\n        }\n\n        const styleEl = (target as Node) as HTMLStyleElement;\n        const styleSheet = <CSSStyleSheet>styleEl.sheet;\n\n        if (d.adds) {\n          d.adds.forEach(({ rule, index }) => {\n            const _index =\n              index === undefined\n                ? undefined\n                : Math.min(index, styleSheet.rules.length);\n            try {\n              styleSheet.insertRule(rule, _index);\n            } catch (e) {\n              /**\n               * sometimes we may capture rules with browser prefix\n               * insert rule with prefixs in other browsers may cause Error\n               */\n            }\n          });\n        }\n\n        if (d.removes) {\n          d.removes.forEach(({ index }) => {\n            styleSheet.deleteRule(index);\n          });\n        }\n        break;\n      }\n      default:\n    }\n  }\n\n  private legacy_resolveMissingNode(\n    map: missingNodeMap,\n    parent: Node,\n    target: Node,\n    targetMutation: addedNodeMutation,\n  ) {\n    const { previousId, nextId } = targetMutation;\n    const previousInMap = previousId && map[previousId];\n    const nextInMap = nextId && map[nextId];\n    if (previousInMap) {\n      const { node, mutation } = previousInMap as missingNode;\n      parent.insertBefore(node, target);\n      delete map[mutation.node.id];\n      delete this.legacy_missingNodeRetryMap[mutation.node.id];\n      if (mutation.previousId || mutation.nextId) {\n        this.legacy_resolveMissingNode(map, parent, node as Node, mutation);\n      }\n    }\n    if (nextInMap) {\n      const { node, mutation } = nextInMap as missingNode;\n      parent.insertBefore(node, target.nextSibling);\n      delete map[mutation.node.id];\n      delete this.legacy_missingNodeRetryMap[mutation.node.id];\n      if (mutation.previousId || mutation.nextId) {\n        this.legacy_resolveMissingNode(map, parent, node as Node, mutation);\n      }\n    }\n  }\n\n  private moveAndHover(d: incrementalData, x: number, y: number, id: number) {\n    this.mouse.style.left = `${x}px`;\n    this.mouse.style.top = `${y}px`;\n    const target = mirror.getNode(id);\n    if (!target) {\n      return this.debugNodeNotFound(d, id);\n    }\n    this.hoverElements((target as Node) as Element);\n  }\n\n  private hoverElements(el: Element) {\n    this.iframe\n      .contentDocument!.querySelectorAll('.\\\\:hover')\n      .forEach((hoveredEl) => {\n        hoveredEl.classList.remove(':hover');\n      });\n    let currentEl: Element | null = el;\n    while (currentEl) {\n      if (currentEl.classList) {\n        currentEl.classList.add(':hover');\n      }\n      currentEl = currentEl.parentElement;\n    }\n  }\n\n  private isUserInteraction(event: eventWithTime): boolean {\n    if (event.type !== EventType.IncrementalSnapshot) {\n      return false;\n    }\n    return (\n      event.data.source > IncrementalSource.Mutation &&\n      event.data.source <= IncrementalSource.Input\n    );\n  }\n\n  private restoreSpeed() {\n    if (this.noramlSpeed === -1) {\n      return;\n    }\n    const payload = { speed: this.noramlSpeed };\n    this.setConfig(payload);\n    this.emitter.emit(ReplayerEvents.SkipEnd, payload);\n    this.noramlSpeed = -1;\n  }\n\n  private warnNodeNotFound(d: incrementalData, id: number) {\n    if (!this.config.showWarning) {\n      return;\n    }\n    console.warn(REPLAY_CONSOLE_PREFIX, `Node with id '${id}' not found in`, d);\n  }\n\n  private debugNodeNotFound(d: incrementalData, id: number) {\n    /**\n     * There maybe some valid scenes of node not being found.\n     * Because DOM events are macrotask and MutationObserver callback\n     * is microtask, so events fired on a removed DOM may emit\n     * snapshots in the reverse order.\n     */\n    if (!this.config.showDebug) {\n      return;\n    }\n    // tslint:disable-next-line: no-console\n    console.log(REPLAY_CONSOLE_PREFIX, `Node with id '${id}' not found in`, d);\n  }\n}\n"],"names":["NodeType","__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","this","__values","o","Symbol","iterator","m","next","value","done","TypeError","__read","r","e","ar","push","error","commentre","parse","css","options","lineno","column","updatePosition","str","lines","match","lastIndexOf","position","start","line","node","Position","whitespace","end","source","content","errorsList","msg","err","Error","reason","filename","silent","open","close","rules","comments","charAt","atrule","rule","re","exec","slice","c","comment","pos","type","selector","trim","replace","split","map","declaration","propMatch","prop","val","ret","property","declarations","decl","decls","keyframe","vals","values","rulesList","atimport","_compileAtrule","atcharset","atnamespace","name","RegExp","vendor","frame","frames","concat","keyframes","atkeyframes","media","style","atmedia","atcustommedia","supports","atsupports","doc","document","atdocument","sel","selectors","atpage","athost","atfontface","addParent","obj","parent","isNode","childParent","_i","_a","keys","k","Array","isArray","forEach","v","defineProperty","configurable","writable","enumerable","stylesheet","parsingErrors","tagMap","script","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","clippath","feblend","fecolormatrix","fecomponenttransfer","fecomposite","feconvolvematrix","fediffuselighting","fedisplacementmap","fedistantlight","fedropshadow","feflood","fefunca","fefuncb","fefuncg","fefuncr","fegaussianblur","feimage","femerge","femergenode","femorphology","feoffset","fepointlight","fespecularlighting","fespotlight","fetile","feturbulence","foreignobject","glyphref","lineargradient","radialgradient","HOVER_SELECTOR","addHoverClass","cssText","ast","test","newSelector","buildNode","HACK_CSS","Document","implementation","createDocument","DocumentType","createDocumentType","publicId","systemId","Element","node_1","tagName","attributes","_cssText","getTagName","isSVG","createElementNS","createElement","_loop_1","startsWith","image_1","src","onload","ctx","getContext","drawImage","width","height","play","pause","isTextarea","isRemoteOrDynamicCss","child","createTextNode","from","childNodes","nodeType","TEXT_NODE","removeChild","appendChild","setAttributeNS","substring","setAttribute","Text","isStyle","textContent","CDATA","createCDATASection","Comment","createComment","buildNodeWithSN","skipChild","__sn","id","childN","childNode","console","warn","mitt","all","create","on","handler","off","splice","indexOf","emit","evt","EventType","IncrementalSource","MouseInteractions","MediaInteractions","ReplayerEvents","module","polyfill","w","window","d","documentElement","__forceSmoothScrollPolyfill__","userAgent","HTMLElement","original","scroll","scrollTo","scrollBy","elementScroll","scrollElement","scrollIntoView","now","performance","bind","Date","ROUNDING_TOLERANCE","navigator","join","undefined","shouldBailOut","smoothScroll","body","left","scrollX","pageXOffset","top","scrollY","pageYOffset","scrollLeft","scrollTop","SyntaxError","behavior","scrollableParent","findScrollableParent","parentRects","getBoundingClientRect","clientRects","getComputedStyle","x","y","firstArg","hasScrollableSpace","el","axis","clientHeight","scrollHeight","clientWidth","scrollWidth","canOverflow","overflowValue","isScrollable","isScrollableY","isScrollableX","parentNode","host","step","context","currentX","currentY","elapsed","startTime","Math","cos","PI","startX","startY","method","scrollable","requestAnimationFrame","config","actions","Timer","action","index","findActionIndex","sort","a1","a2","delay","timeOffset","lastTimestamp","self","raf","check","time","speed","shift","doAction","liveMode","cancelAnimationFrame","mid","floor","getDelay","event","baselineTime","IncrementalSnapshot","data","MouseMove","firstOffset","positions","firstTimestamp","timestamp","NotStarted","Running","Stopped","assignment","a","u","changed","matches","createPlayerService","getCastFn","emitter","initialState","Set","_machine","send","transition","subscribe","add","unsubscribe","delete","stop","clear","state","status","interpret","_options","initial","states","entry","f","l","g","target","cond","h","exit","filter","S","return","createMachine","inited","PLAY","TO_LIVE","playing","PAUSE","END","FAST_FORWARD","CAST_EVENT","paused","RESUME","skipping","BACK_TO_NORMAL","ended","REPLAY","live","ADD_EVENT","castEvent","lastPlayedEvent","payload","recordTimeOffset","events","timer","isSync","castFn","EventCast","events_1","addActions","startLive","addEvent","machineEvent","event_1","castFn_1","addAction","mirror","getId","getNode","removeNodeFromMap","has","mittProxy.default","mittProxy","defaultConfig","root","loadTimeout","skipInactive","showWarning","showDebug","blockClass","insertStyleRules","triggerFocus","handleResize","smoothscroll.polyfill","NodeList","setupDom","service","unpackFn","contextEvents","firstMeta","find","Meta","firstFullsnapshot","FullSnapshot","Resize","rebuildFullSnapshot","Replayer","key","_this","noramlSpeed","firstEvent","totalTime","getTimeOffset","Start","Pause","Resume","rawEvent","Promise","resolve","then","iframe","pointerEvents","wrapper","classList","mouse","disableInteract","dimension","String","DomContentLoaded","Load","Custom","CustomEvent","contentWindow","initialOffset","applyIncremental","nextUserInteractionEvent","restoreSpeed","_event","isUserInteraction","skipTime","min","round","setConfig","SkipStart","Finish","legacy_missingNodeRetryMap","idNodeMap","rebuild","contentDocument","styleEl","head","insertBefore","injectStylesRules","idx","sheet","insertRule","FullsnapshotRebuilded","waitForStylesheetLoad","timer_1","unloadSheets_1","beforeLoadState_1","querySelectorAll","addEventListener","size","resume","getCurrentTime","LoadStylesheetEnd","clearTimeout","LoadStylesheetStart","setTimeout","Mutation","removes","mutation","warnNodeNotFound","parentId","legacy_missingNodeMap_1","queue_1","appendNode_1","previous","previousId","nextId","nextSibling","contains","legacy_resolveMissingNode","adds","every","Boolean","texts","attributeName","removeAttribute","lastPosition","moveAndHover","MouseInteraction","Event","toLowerCase","debugNodeNotFound","Blur","blur","Focus","focus","preventScroll","Click","TouchStart","TouchEnd","remove","offsetWidth","dispatchEvent","Scroll","ViewportResize","Input","checked","isChecked","text","MediaInteraction","mediaEl_1","Play","readyState","HTMLMediaElement","HAVE_CURRENT_DATA","StyleSheetRule","styleSheet_1","_index","deleteRule","targetMutation","previousInMap","nextInMap","_b","hoverElements","hoveredEl","currentEl","parentElement","SkipEnd","log"],"mappings":"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"}